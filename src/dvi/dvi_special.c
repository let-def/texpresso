/* Generated by re2c 3.1 on Tue Jun  3 10:14:06 2025 */
#line 1 "dvi_special.re2c.c"
/*
 * MIT License
 *
 * Copyright (c) 2023 Frédéric Bour <frederic.bour@lakaban.net>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to
 * deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 * sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 * IN THE SOFTWARE.
 */

#include <mupdf/pdf.h>
#include <string.h>
#include "fz_util.h"
#include "mydvi.h"
#include "mydvi_interp.h"
#include "pdf_lexer.h"
#include "vstack.h"
#include <math.h>

#define device_cs fz_device_rgb
#define color_params fz_default_color_params

typedef const char *cursor_t;

#line 65 "dvi_special.re2c.c"


#line 45 "dvi_special.c"
static cursor_t yyt1;
static cursor_t yyt2;
static cursor_t yyt3;
static cursor_t yyt4;
static cursor_t yyt5;
static cursor_t yyt6;
#line 67 "dvi_special.re2c.c"


static bool
unhandled(const char *kind, cursor_t cur, cursor_t lim, int ignored)
{
  if (0 && !ignored)
    fprintf(stderr, "unhandled %s: \"%.*s\"\n", kind, (int)(lim - cur), cur);
  return 0;
}

static int pnat(cursor_t ptr, cursor_t lim)
{
  int result = 0;
  for (; ptr < lim && *ptr >= '0' && *ptr <= '9'; ptr += 1)
    result = result * 10 + (*ptr - '0');
  return result;
}

static int pint(cursor_t ptr, cursor_t lim)
{
  if (ptr < lim && *ptr == '-')
    return -pnat(ptr + 1, lim);
  else
    return pnat(ptr, lim);
}

static float
punit(cursor_t cur, cursor_t lim)
{
  if (cur + 2 >= lim)
    return 1.0;

  if (cur + 6 >= lim &&
      cur[0] == 't' && cur[1] == 'r' &&
      cur[2] == 'u' && cur[3] == 'e')
  {
    // TODO: "true" units are not yet supported
    cur += 4;
  }

  char c0 = cur[0];
  char c1 = cur[1];

  if (0);
  else if (c0 == 'p' && c1 == 't')
    return 1.0;
  else if (c0 == 'm' && c1 == 'm')
    return 2.845274;
  else if (c0 == 'c' && c1 == 'm')
    return 28.45274;
  else if (c0 == 'i' && c1 == 'n')
    return 72.27;

  return 1.0;
}

static float
pfloat_or_dim(cursor_t ptr, cursor_t lim, bool is_dim)
{
  int neg = 0;
  double result = 0;
  if (ptr < lim && *ptr == '-')
  {
    neg = 1;
    ptr += 1;
  }
  for (; ptr < lim && *ptr >= '0' && *ptr <= '9'; ptr += 1)
    result = result * 10 + (*ptr - '0');
  if (ptr < lim  && *ptr == '.')
  {
    ptr += 1;
    double pos = 0.1;
    for (; ptr < lim && *ptr >= '0' && *ptr <= '9'; ptr += 1)
    {
      result += pos * (*ptr - '0');
      pos /= 10;
    }
  }

  if (is_dim)
    result *= punit(ptr, lim) * 800/803;
  return neg ? -result : result;
}

static float pfloat(cursor_t ptr, cursor_t lim)
{
  return pfloat_or_dim(ptr, lim, 0);
}

static float pdim(cursor_t ptr, cursor_t lim)
{
  return pfloat_or_dim(ptr, lim, 1);
}

static void color_set_rgb(float color[3], float r, float g, float b)
{
  color[0] = r;
  color[1] = g;
  color[2] = b;
}

static void color_set_gray(float color[3], float gray)
{
  color_set_rgb(color, gray, gray, gray);
}

static void color_set_cmyk(float color[3], float c, float m, float y, float k)
{
  color_set_rgb(
    color,
    (1 - c) * (1 - k),
    (1 - m) * (1 - k),
    (1 - y) * (1 - k)
  );
}

static bool
color_parse_rgb(float color[3], cursor_t r, cursor_t g, cursor_t b, cursor_t lim)
{
  color_set_rgb(color, pfloat(r, lim), pfloat(g, lim), pfloat(b, lim));
  return 1;
}

static bool
color_parse_gray(float color[3], cursor_t gray, cursor_t lim)
{
  color_set_gray(color, pfloat(gray, lim));
  return 1;
}

static bool
color_parse_cmyk(float color[3], cursor_t c, cursor_t m, cursor_t y, cursor_t k, cursor_t lim)
{
  color_set_cmyk(color, pfloat(c, lim), pfloat(m, lim),
                        pfloat(y, lim), pfloat(k, lim));
  return 1;
}

static bool parse_color(dvi_colorstate *state, cursor_t cur, cursor_t lim)
{
  cursor_t mar, f0, f1, f2, f3;
  // fprintf(stderr, "parse_color: %.*s\n", (int)(lim - cur), cur);
  float color[3];

  do
  {
    
#line 200 "dvi_special.c"
{
	int yych;
	static const unsigned char yybm[] = {
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		 64,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
	};
	mar = cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= 'c') {
		if (yych == ' ') goto yy2;
		if (yych >= 'c') goto yy3;
	} else {
		if (yych <= 'g') {
			if (yych >= 'g') goto yy5;
		} else {
			if (yych == 'r') goto yy6;
		}
	}
yy1:
#line 242 "dvi_special.re2c.c"
	{ return unhandled("color", cur, lim, 0); }
#line 252 "dvi_special.c"
yy2:
	++cur;
#line 216 "dvi_special.re2c.c"
	{ continue; }
#line 257 "dvi_special.c"
yy3:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'm') goto yy7;
yy4:
	cur = mar;
	goto yy1;
yy5:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'r') goto yy8;
	goto yy4;
yy6:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'g') goto yy9;
	goto yy4;
yy7:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'y') goto yy10;
	goto yy4;
yy8:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'a') goto yy11;
	goto yy4;
yy9:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'b') goto yy12;
	goto yy4;
yy10:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'k') goto yy13;
	goto yy4;
yy11:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'y') goto yy14;
	goto yy4;
yy12:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yybm[0+yych] & 64) {
		goto yy15;
	}
	goto yy4;
yy13:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy16;
	goto yy4;
yy14:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy17;
	goto yy4;
yy15:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yybm[0+yych] & 64) {
		goto yy15;
	}
	if (yych == '-') {
		yyt1 = cur;
		goto yy18;
	}
	if (yych <= '/') goto yy4;
	if (yych <= '9') {
		yyt1 = cur;
		goto yy19;
	}
	goto yy4;
yy16:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= ',') {
		if (yych == ' ') goto yy16;
		goto yy4;
	} else {
		if (yych <= '-') {
			yyt1 = cur;
			goto yy20;
		}
		if (yych <= '/') goto yy4;
		if (yych <= '9') {
			yyt1 = cur;
			goto yy21;
		}
		goto yy4;
	}
yy17:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= ',') {
		if (yych == ' ') goto yy17;
		goto yy4;
	} else {
		if (yych <= '-') {
			yyt1 = cur;
			goto yy22;
		}
		if (yych <= '/') goto yy4;
		if (yych <= '9') {
			yyt1 = cur;
			goto yy23;
		}
		goto yy4;
	}
yy18:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yybm[0+yych] & 128) {
		goto yy19;
	}
	goto yy4;
yy19:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yybm[0+yych] & 128) {
		goto yy19;
	}
	if (yych == ' ') goto yy25;
	if (yych == '.') goto yy26;
	goto yy4;
yy20:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy4;
	if (yych >= ':') goto yy4;
yy21:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '-') {
		if (yych == ' ') goto yy27;
		goto yy4;
	} else {
		if (yych <= '.') goto yy28;
		if (yych <= '/') goto yy4;
		if (yych <= '9') goto yy21;
		goto yy4;
	}
yy22:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy4;
	if (yych >= ':') goto yy4;
yy23:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == '.') goto yy29;
	if (yych <= '/') goto yy24;
	if (yych <= '9') goto yy23;
yy24:
	f0 = yyt1;
#line 219 "dvi_special.re2c.c"
	{
      color_parse_gray(color, f0, lim);
      break;
    }
#line 420 "dvi_special.c"
yy25:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= ',') {
		if (yych == ' ') goto yy25;
		goto yy4;
	} else {
		if (yych <= '-') {
			yyt2 = cur;
			goto yy30;
		}
		if (yych <= '/') goto yy4;
		if (yych <= '9') {
			yyt2 = cur;
			goto yy31;
		}
		goto yy4;
	}
yy26:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy25;
	if (yych <= '/') goto yy4;
	if (yych <= '9') goto yy26;
	goto yy4;
yy27:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= ',') {
		if (yych == ' ') goto yy27;
		goto yy4;
	} else {
		if (yych <= '-') {
			yyt2 = cur;
			goto yy32;
		}
		if (yych <= '/') goto yy4;
		if (yych <= '9') {
			yyt2 = cur;
			goto yy33;
		}
		goto yy4;
	}
yy28:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy27;
	if (yych <= '/') goto yy4;
	if (yych <= '9') goto yy28;
	goto yy4;
yy29:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy24;
	if (yych <= '9') goto yy29;
	goto yy24;
yy30:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy4;
	if (yych >= ':') goto yy4;
yy31:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '-') {
		if (yych == ' ') goto yy34;
		goto yy4;
	} else {
		if (yych <= '.') goto yy35;
		if (yych <= '/') goto yy4;
		if (yych <= '9') goto yy31;
		goto yy4;
	}
yy32:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy4;
	if (yych >= ':') goto yy4;
yy33:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '-') {
		if (yych == ' ') goto yy36;
		goto yy4;
	} else {
		if (yych <= '.') goto yy37;
		if (yych <= '/') goto yy4;
		if (yych <= '9') goto yy33;
		goto yy4;
	}
yy34:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= ',') {
		if (yych == ' ') goto yy34;
		goto yy4;
	} else {
		if (yych <= '-') {
			yyt3 = cur;
			goto yy38;
		}
		if (yych <= '/') goto yy4;
		if (yych <= '9') {
			yyt3 = cur;
			goto yy39;
		}
		goto yy4;
	}
yy35:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy34;
	if (yych <= '/') goto yy4;
	if (yych <= '9') goto yy35;
	goto yy4;
yy36:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= ',') {
		if (yych == ' ') goto yy36;
		goto yy4;
	} else {
		if (yych <= '-') {
			yyt3 = cur;
			goto yy41;
		}
		if (yych <= '/') goto yy4;
		if (yych <= '9') {
			yyt3 = cur;
			goto yy42;
		}
		goto yy4;
	}
yy37:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy36;
	if (yych <= '/') goto yy4;
	if (yych <= '9') goto yy37;
	goto yy4;
yy38:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy4;
	if (yych >= ':') goto yy4;
yy39:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == '.') goto yy43;
	if (yych <= '/') goto yy40;
	if (yych <= '9') goto yy39;
yy40:
	f0 = yyt1;
	f1 = yyt2;
	f2 = yyt3;
#line 227 "dvi_special.re2c.c"
	{
      color_parse_rgb(color, f0, f1, f2, lim);
      break;
    }
#line 581 "dvi_special.c"
yy41:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy4;
	if (yych >= ':') goto yy4;
yy42:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '-') {
		if (yych == ' ') goto yy44;
		goto yy4;
	} else {
		if (yych <= '.') goto yy45;
		if (yych <= '/') goto yy4;
		if (yych <= '9') goto yy42;
		goto yy4;
	}
yy43:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy40;
	if (yych <= '9') goto yy43;
	goto yy40;
yy44:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= ',') {
		if (yych == ' ') goto yy44;
		goto yy4;
	} else {
		if (yych <= '-') {
			yyt4 = cur;
			goto yy46;
		}
		if (yych <= '/') goto yy4;
		if (yych <= '9') {
			yyt4 = cur;
			goto yy47;
		}
		goto yy4;
	}
yy45:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy44;
	if (yych <= '/') goto yy4;
	if (yych <= '9') goto yy45;
	goto yy4;
yy46:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy4;
	if (yych >= ':') goto yy4;
yy47:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == '.') goto yy49;
	if (yych <= '/') goto yy48;
	if (yych <= '9') goto yy47;
yy48:
	f0 = yyt1;
	f1 = yyt2;
	f2 = yyt3;
	f3 = yyt4;
#line 236 "dvi_special.re2c.c"
	{
      color_parse_cmyk(color, f0, f1, f2, f3, lim);
      break;
    }
#line 651 "dvi_special.c"
yy49:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy48;
	if (yych <= '9') goto yy49;
	goto yy48;
}
#line 244 "dvi_special.re2c.c"

  }
  while (0);

  state->fill[0] = state->line[0] = color[0];
  state->fill[1] = state->line[1] = color[1];
  state->fill[2] = state->line[2] = color[2];
  return 1;
}

static bool parse_pdfcolor(dvi_colorstate *state, cursor_t cur, cursor_t lim)
{
  cursor_t mar, f0, f1, f2, f3;

  for (;;)
  {
    
#line 677 "dvi_special.c"
{
	int yych;
	static const unsigned char yybm[] = {
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		128,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
	};
	mar = cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= ')') {
		if (yych == ' ') goto yy52;
		if (yych >= ')') goto yy53;
	} else {
		if (yych <= '-') {
			if (yych >= '-') {
				yyt1 = cur;
				goto yy54;
			}
		} else {
			if (yych <= '/') goto yy51;
			if (yych <= '9') {
				yyt1 = cur;
				goto yy56;
			}
		}
	}
yy51:
#line 303 "dvi_special.re2c.c"
	{ return unhandled("pdf color", cur, lim, 0); }
#line 736 "dvi_special.c"
yy52:
	++cur;
#line 266 "dvi_special.re2c.c"
	{ continue; }
#line 741 "dvi_special.c"
yy53:
	++cur;
#line 263 "dvi_special.re2c.c"
	{ return 1; }
#line 746 "dvi_special.c"
yy54:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yybm[0+yych] & 64) {
		goto yy56;
	}
yy55:
	cur = mar;
	goto yy51;
yy56:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yybm[0+yych] & 128) {
		goto yy57;
	}
	if (yych == '.') goto yy58;
	if (yych <= '/') goto yy55;
	if (yych <= '9') goto yy56;
	goto yy55;
yy57:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yybm[0+yych] & 128) {
		goto yy57;
	}
	if (yych <= '9') {
		if (yych == '-') {
			yyt2 = cur;
			goto yy59;
		}
		if (yych <= '/') goto yy55;
		yyt2 = cur;
		goto yy60;
	} else {
		if (yych <= 'G') {
			if (yych <= 'F') goto yy55;
			goto yy61;
		} else {
			if (yych == 'g') goto yy62;
			goto yy55;
		}
	}
yy58:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yybm[0+yych] & 128) {
		goto yy57;
	}
	if (yych <= '/') goto yy55;
	if (yych <= '9') goto yy58;
	goto yy55;
yy59:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy55;
	if (yych >= ':') goto yy55;
yy60:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '-') {
		if (yych == ' ') goto yy63;
		goto yy55;
	} else {
		if (yych <= '.') goto yy64;
		if (yych <= '/') goto yy55;
		if (yych <= '9') goto yy60;
		goto yy55;
	}
yy61:
	++cur;
	f0 = yyt1;
#line 288 "dvi_special.re2c.c"
	{ return color_parse_gray(state->line, f0, lim); }
#line 820 "dvi_special.c"
yy62:
	++cur;
	f0 = yyt1;
#line 284 "dvi_special.re2c.c"
	{ return color_parse_gray(state->fill, f0, lim); }
#line 826 "dvi_special.c"
yy63:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= ',') {
		if (yych == ' ') goto yy63;
		goto yy55;
	} else {
		if (yych <= '-') {
			yyt3 = cur;
			goto yy65;
		}
		if (yych <= '/') goto yy55;
		if (yych <= '9') {
			yyt3 = cur;
			goto yy66;
		}
		goto yy55;
	}
yy64:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy63;
	if (yych <= '/') goto yy55;
	if (yych <= '9') goto yy64;
	goto yy55;
yy65:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy55;
	if (yych >= ':') goto yy55;
yy66:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '-') {
		if (yych != ' ') goto yy55;
	} else {
		if (yych <= '.') goto yy68;
		if (yych <= '/') goto yy55;
		if (yych <= '9') goto yy66;
		goto yy55;
	}
yy67:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') {
		if (yych <= ' ') {
			if (yych <= 0x1F) goto yy55;
			goto yy67;
		} else {
			if (yych == '-') {
				yyt4 = cur;
				goto yy69;
			}
			goto yy55;
		}
	} else {
		if (yych <= 'R') {
			if (yych <= '9') {
				yyt4 = cur;
				goto yy70;
			}
			if (yych <= 'Q') goto yy55;
			goto yy71;
		} else {
			if (yych == 'r') goto yy72;
			goto yy55;
		}
	}
yy68:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy67;
	if (yych <= '/') goto yy55;
	if (yych <= '9') goto yy68;
	goto yy55;
yy69:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy55;
	if (yych >= ':') goto yy55;
yy70:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '-') {
		if (yych == ' ') goto yy73;
		goto yy55;
	} else {
		if (yych <= '.') goto yy74;
		if (yych <= '/') goto yy55;
		if (yych <= '9') goto yy70;
		goto yy55;
	}
yy71:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'G') goto yy75;
	goto yy55;
yy72:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'g') goto yy76;
	goto yy55;
yy73:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= 'J') {
		if (yych == ' ') goto yy73;
		goto yy55;
	} else {
		if (yych <= 'K') goto yy77;
		if (yych == 'k') goto yy78;
		goto yy55;
	}
yy74:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy73;
	if (yych <= '/') goto yy55;
	if (yych <= '9') goto yy74;
	goto yy55;
yy75:
	++cur;
	f0 = yyt1;
	f1 = yyt2;
	f2 = yyt3;
#line 300 "dvi_special.re2c.c"
	{ return color_parse_rgb(state->line, f0, f1, f2, lim); }
#line 954 "dvi_special.c"
yy76:
	++cur;
	f0 = yyt1;
	f1 = yyt2;
	f2 = yyt3;
#line 294 "dvi_special.re2c.c"
	{ return color_parse_rgb(state->fill, f0, f1, f2, lim); }
#line 962 "dvi_special.c"
yy77:
	++cur;
	f0 = yyt1;
	f1 = yyt2;
	f2 = yyt3;
	f3 = yyt4;
#line 280 "dvi_special.re2c.c"
	{ return color_parse_cmyk(state->line, f0, f1, f2, f3, lim); }
#line 971 "dvi_special.c"
yy78:
	++cur;
	f0 = yyt1;
	f1 = yyt2;
	f2 = yyt3;
	f3 = yyt4;
#line 273 "dvi_special.re2c.c"
	{ return color_parse_cmyk(state->fill, f0, f1, f2, f3, lim); }
#line 980 "dvi_special.c"
}
#line 305 "dvi_special.re2c.c"

  }
}

static bool
pdfcolorstack_current(fz_context *ctx, dvi_context *dc, dvi_state *st, int index)
{
  dvi_context_flush_text(ctx, dc, st);
  if (index >= dc->pdfcolorstacks.capacity)
  {
    fprintf(stderr, "pdfcolorstack_current %d: no such stack\n", index);
    return 0;
  }
  //printf("pdfcolorstack_current %d\n", index);
  dvi_colorstack *stack = index == -1 ? &dc->colorstack : &dc->pdfcolorstacks.stacks[index];
  if (stack->depth == 0)
    st->gs.colors = stack->origin;
  else
    st->gs.colors = stack->base[stack->depth - 1];
  return 1;
}

static bool
colorstack_push(fz_context *ctx, dvi_context *dc, dvi_state *st, int index)
{
  dvi_context_flush_text(ctx, dc, st);
  if (index >= dc->pdfcolorstacks.capacity)
  {
    fprintf(stderr, "pdfcolorstack_push %d: no such stack\n", index);
    return 0;
  }
  //printf("pdfcolorstack_push %d\n", index);
  dvi_colorstack *stack = index == -1 ? &dc->colorstack : &dc->pdfcolorstacks.stacks[index];

  //fprintf(stderr, "pdfcolorstack_push: depth=%d, limit=%d\n", stack->depth, stack->limit);
  if (stack->depth == stack->limit)
  {
    size_t size = stack->limit;
    size = size == 0 ? 16 : size * 2;
    dvi_colorstate *base = fz_malloc_struct_array(ctx, size, dvi_colorstate);
    if (!base) abort();
    if (stack->limit > 0)
    {
      memcpy(base, stack->base, sizeof(dvi_colorstate) * stack->limit);
      fz_free(ctx, stack->base);
    }
    stack->base = base;
    stack->limit = size;
  }

  stack->base[stack->depth] = st->gs.colors;
  stack->depth += 1;

  return 1;
}

static bool
colorstack_pop(fz_context *ctx, dvi_context *dc, dvi_state *st, int index)
{
  dvi_context_flush_text(ctx, dc, st);
  if (index >= dc->pdfcolorstacks.capacity)
  {
    fprintf(stderr, "pdfcolorstack_pop %d: no such stack\n", index);
    return 0;
  }
  dvi_colorstack *stack = index == -1 ? &dc->colorstack : &dc->pdfcolorstacks.stacks[index];
  if (stack->depth == 0)
  {
    fprintf(stderr, "pdfcolorstack_pop %d: empty stack\n", index);
    return 0;
  }
  stack->depth -= 1;
  st->gs.colors = stack->base[stack->depth];
  return 1;
}

static bool
colorstack_init(fz_context *ctx, dvi_context *dc, dvi_state *st, int index)
{
  if (index >= dc->pdfcolorstacks.capacity)
  {
    size_t cap = dc->pdfcolorstacks.capacity;
    size_t newcap = cap == 0 ? 4 : cap;
    while (newcap < index) newcap *= 2;
    dvi_colorstack *stacks = fz_malloc_struct_array(ctx, newcap, dvi_colorstack);
    if (!stacks) abort();
    if (cap > 0)
    {
      memcpy(stacks, dc->pdfcolorstacks.stacks, sizeof(dvi_colorstack) * cap);
      fz_free(ctx, dc->pdfcolorstacks.stacks);
    }
    dc->pdfcolorstacks.stacks = stacks;
    dc->pdfcolorstacks.capacity = newcap;
  }
  //printf("pdfcolorstackinit %d\n", index);
  dvi_colorstack *stack = &dc->pdfcolorstacks.stacks[index];
  return 1;
}

enum pagebox
{
  BOX_UNDEFINED,
  BOX_MEDIABOX,
  BOX_CROPBOX,
  BOX_ARTBOX,
  BOX_BLEEDBOX,
  BOX_TRIMBOX,
};

struct xform_spec
{
  fz_matrix ctm;
  float width, height, depth;
  fz_rect bbox;
  int page, clip;
  enum pagebox pagebox;
};

static struct xform_spec xform_spec()
{
  return (struct xform_spec){
      .ctm = fz_identity,
      .width = NAN,
      .height = NAN,
      .depth = NAN,
      .bbox = fz_infinite_rect,
      .page = -1,
      .clip = 0,
      .pagebox = BOX_UNDEFINED,
  };
}

static bool
embed_pdf(fz_context *ctx, dvi_context *dc, dvi_state *st, struct xform_spec *xf, const char *filename)
{
  fz_try(ctx)
  {
    pdf_document *doc = dvi_resmanager_get_pdf(ctx, dc->resmanager, filename);
    if (!doc)
      return 0;

    // from mupdf/source/pdf/pdf-page.c: pdf_page_obj_transform
    pdf_page *page = pdf_load_page(ctx, doc, xf->page ? xf->page - 1 : 0);
    pdf_obj *pageobj = page ? page->obj : NULL;

    fz_rect mediabox = pdf_to_rect(ctx, pdf_dict_get_inheritable(ctx, pageobj, PDF_NAME(MediaBox)));
    if (fz_is_empty_rect(mediabox))
    {
      mediabox.x0 = 0;
      mediabox.y0 = 0;
      mediabox.x1 = 612;
      mediabox.y1 = 792;
    }

    fz_rect cropbox = pdf_to_rect(ctx, pdf_dict_get_inheritable(ctx, pageobj, PDF_NAME(CropBox)));
    if (!fz_is_empty_rect(cropbox))
      mediabox = fz_intersect_rect(mediabox, cropbox);

    fz_matrix ctm = fz_flip_vertically(dvi_get_ctm(dc, st));
    ctm = fz_concat(xf->ctm, ctm);
    ctm = fz_pre_translate(ctm, 0, mediabox.y0 - mediabox.y1);
    pdf_run_page(ctx, page, dc->dev, ctm, NULL);
  }
  fz_catch(ctx)
  {
    return 0;
  }
  return 1;
}

static bool
embed_image(fz_context *ctx, dvi_context *dc, dvi_state *st, struct xform_spec *xf, const char *filename)
{

  fz_image *img = NULL;
  fz_var(img);

  fz_try(ctx)
  {
    fz_image *img = dvi_resmanager_get_img(ctx, dc->resmanager, filename);
    fz_matrix ctm = fz_concat(xf->ctm, dvi_get_ctm(dc, st));
    // int xres, yres;
    // fz_image_resolution(img, &xres, &yres);
    // fprintf(stderr, "RENDERING IMAGE, size: %d %d, res: %d %d\n",
    //         img->w, img->h, xres, yres);
    //
    float ar = (float)img->w / (float)img->h;
    float w = xf->width, h = xf->height;
    if (w != w) w = h * ar;
    if (h != h) h = w / ar;
    ctm = fz_pre_scale(fz_pre_translate(ctm, 0, h), w, -h);
    fz_fill_image(ctx, dc->dev, img, ctm, 1.0, color_params);
  }
  fz_always(ctx)
  {
    if (img)
      fz_drop_image(ctx, img);
  }
  fz_catch(ctx)
  {
    return 0;
  }
  return 1;
}

static bool
embed_graphics(fz_context *ctx, dvi_context *dc, dvi_state *st, struct xform_spec *xf, const char *filename)
{
  if (!dc->dev)
    return 1;

  const char *ext = filename;

  for (const char *ptr = ext; *ptr; ptr++)
    if (*ptr == '.') ext = ptr + 1;

  if ((ext[0] == 'p' || ext[0] == 'P') &&
      (ext[1] == 'd' || ext[1] == 'D') &&
      (ext[2] == 'f' || ext[2] == 'F'))
    return embed_pdf(ctx, dc, st, xf, filename);
  else
    return embed_image(ctx, dc, st, xf, filename);
}

static cursor_t
parse_xform_or_dim(struct xform_spec *xf, cursor_t cur, cursor_t lim)
{
  //fprintf(stderr, "pdf xform: %.*s\n", (int)(lim - cur), cur);
  cursor_t i, f0, f1, f2, f3, f4, f5, mar;
  float r = 0, sx = 1.0, sy = 1.0;

  while (cur < lim)
  {
    
#line 1217 "dvi_special.c"
{
	int yych;
	static const unsigned char yybm[] = {
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		 64,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
	};
	mar = cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= 'm') {
		if (yych <= 'c') {
			if (yych <= ' ') {
				if (yych >= ' ') goto yy81;
			} else {
				if (yych <= 'a') goto yy80;
				if (yych <= 'b') goto yy82;
				goto yy84;
			}
		} else {
			if (yych <= 'g') {
				if (yych <= 'd') goto yy85;
			} else {
				if (yych <= 'h') goto yy86;
				if (yych >= 'm') goto yy87;
			}
		}
	} else {
		if (yych <= 's') {
			if (yych <= 'p') {
				if (yych >= 'p') goto yy88;
			} else {
				if (yych <= 'q') goto yy80;
				if (yych <= 'r') goto yy89;
				goto yy90;
			}
		} else {
			if (yych <= 'w') {
				if (yych >= 'w') goto yy91;
			} else {
				if (yych <= 'x') goto yy92;
				if (yych <= 'y') goto yy93;
			}
		}
	}
yy80:
#line 650 "dvi_special.re2c.c"
	{ break; }
#line 1294 "dvi_special.c"
yy81:
	++cur;
#line 541 "dvi_special.re2c.c"
	{ continue; }
#line 1299 "dvi_special.c"
yy82:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'b') goto yy94;
yy83:
	cur = mar;
	goto yy80;
yy84:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'l') goto yy95;
	goto yy83;
yy85:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'e') goto yy96;
	goto yy83;
yy86:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'e') goto yy97;
	goto yy83;
yy87:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'a') goto yy98;
	goto yy83;
yy88:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'a') goto yy99;
	goto yy83;
yy89:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'o') goto yy100;
	goto yy83;
yy90:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'c') goto yy101;
	goto yy83;
yy91:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'i') goto yy102;
	goto yy83;
yy92:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 's') goto yy103;
	goto yy83;
yy93:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 's') goto yy104;
	goto yy83;
yy94:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'o') goto yy105;
	goto yy83;
yy95:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'i') goto yy106;
	goto yy83;
yy96:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'p') goto yy107;
	goto yy83;
yy97:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'i') goto yy108;
	goto yy83;
yy98:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 't') goto yy109;
	goto yy83;
yy99:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'g') goto yy110;
	goto yy83;
yy100:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 't') goto yy111;
	goto yy83;
yy101:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'a') goto yy112;
	goto yy83;
yy102:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'd') goto yy113;
	goto yy83;
yy103:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'c') goto yy114;
	goto yy83;
yy104:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'c') goto yy115;
	goto yy83;
yy105:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'x') goto yy116;
	goto yy83;
yy106:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'p') goto yy117;
	goto yy83;
yy107:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 't') goto yy118;
	goto yy83;
yy108:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'g') goto yy119;
	goto yy83;
yy109:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'r') goto yy120;
	goto yy83;
yy110:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'e') goto yy121;
	goto yy83;
yy111:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'a') goto yy122;
	goto yy83;
yy112:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'l') goto yy123;
	goto yy83;
yy113:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 't') goto yy124;
	goto yy83;
yy114:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'a') goto yy125;
	goto yy83;
yy115:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'a') goto yy126;
	goto yy83;
yy116:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yybm[0+yych] & 64) {
		goto yy127;
	}
	goto yy83;
yy117:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy128;
	goto yy83;
yy118:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'h') goto yy129;
	goto yy83;
yy119:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'h') goto yy130;
	goto yy83;
yy120:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'i') goto yy131;
	goto yy83;
yy121:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy132;
	if (yych == 'b') goto yy133;
	goto yy83;
yy122:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 't') goto yy134;
	goto yy83;
yy123:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'e') goto yy135;
	goto yy83;
yy124:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'h') goto yy136;
	goto yy83;
yy125:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'l') goto yy137;
	goto yy83;
yy126:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'l') goto yy138;
	goto yy83;
yy127:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yybm[0+yych] & 64) {
		goto yy127;
	}
	if (yych == '-') {
		yyt1 = cur;
		goto yy139;
	}
	if (yych <= '/') goto yy83;
	if (yych <= '9') {
		yyt1 = cur;
		goto yy140;
	}
	goto yy83;
yy128:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= ',') {
		if (yych == ' ') goto yy128;
		goto yy83;
	} else {
		if (yych <= '-') {
			yyt1 = cur;
			goto yy141;
		}
		if (yych <= '/') goto yy83;
		if (yych <= '9') {
			yyt1 = cur;
			goto yy142;
		}
		goto yy83;
	}
yy129:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy144;
	goto yy83;
yy130:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 't') goto yy145;
	goto yy83;
yy131:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'x') goto yy146;
	goto yy83;
yy132:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy132;
	if (yych <= '/') goto yy83;
	if (yych <= '9') {
		yyt1 = cur;
		goto yy147;
	}
	goto yy83;
yy133:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'o') goto yy149;
	goto yy83;
yy134:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'e') goto yy150;
	goto yy83;
yy135:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy151;
	goto yy83;
yy136:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy152;
	goto yy83;
yy137:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'e') goto yy153;
	goto yy83;
yy138:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'e') goto yy154;
	goto yy83;
yy139:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yybm[0+yych] & 128) {
		goto yy140;
	}
	goto yy83;
yy140:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yybm[0+yych] & 128) {
		goto yy140;
	}
	if (yych == ' ') goto yy155;
	if (yych == '.') goto yy156;
	goto yy83;
yy141:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy83;
	if (yych >= ':') goto yy83;
yy142:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy143;
	if (yych <= '9') goto yy142;
yy143:
	f0 = yyt1;
#line 550 "dvi_special.re2c.c"
	{
      xf->clip = pint(f0, lim);
      continue;
    }
#line 1647 "dvi_special.c"
yy144:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= ',') {
		if (yych == ' ') goto yy144;
		goto yy83;
	} else {
		if (yych <= '-') {
			yyt1 = cur;
			goto yy157;
		}
		if (yych <= '/') goto yy83;
		if (yych <= '9') {
			yyt1 = cur;
			goto yy158;
		}
		goto yy83;
	}
yy145:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy159;
	goto yy83;
yy146:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy160;
	goto yy83;
yy147:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy148;
	if (yych <= '9') goto yy147;
yy148:
	f0 = yyt1;
#line 604 "dvi_special.re2c.c"
	{
      xf->page = pint(f0, lim);
      continue;
    }
#line 1688 "dvi_special.c"
yy149:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'x') goto yy161;
	goto yy83;
yy150:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy162;
	goto yy83;
yy151:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= ',') {
		if (yych == ' ') goto yy151;
		goto yy83;
	} else {
		if (yych <= '-') {
			yyt1 = cur;
			goto yy163;
		}
		if (yych <= '/') goto yy83;
		if (yych <= '9') {
			yyt1 = cur;
			goto yy164;
		}
		goto yy83;
	}
yy152:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= ',') {
		if (yych == ' ') goto yy152;
		goto yy83;
	} else {
		if (yych <= '-') {
			yyt1 = cur;
			goto yy166;
		}
		if (yych <= '/') goto yy83;
		if (yych <= '9') {
			yyt1 = cur;
			goto yy167;
		}
		goto yy83;
	}
yy153:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy168;
	goto yy83;
yy154:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy169;
	goto yy83;
yy155:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= ',') {
		if (yych == ' ') goto yy155;
		goto yy83;
	} else {
		if (yych <= '-') {
			yyt2 = cur;
			goto yy170;
		}
		if (yych <= '/') goto yy83;
		if (yych <= '9') {
			yyt2 = cur;
			goto yy171;
		}
		goto yy83;
	}
yy156:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy155;
	if (yych <= '/') goto yy83;
	if (yych <= '9') goto yy156;
	goto yy83;
yy157:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy83;
	if (yych >= ':') goto yy83;
yy158:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= 'h') {
		if (yych <= '/') {
			if (yych == '.') goto yy172;
			goto yy83;
		} else {
			if (yych <= '9') goto yy158;
			if (yych == 'c') goto yy173;
			goto yy83;
		}
	} else {
		if (yych <= 'o') {
			if (yych <= 'i') goto yy174;
			if (yych == 'm') goto yy173;
			goto yy83;
		} else {
			if (yych <= 'p') goto yy175;
			if (yych == 't') goto yy176;
			goto yy83;
		}
	}
yy159:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= ',') {
		if (yych == ' ') goto yy159;
		goto yy83;
	} else {
		if (yych <= '-') {
			yyt1 = cur;
			goto yy177;
		}
		if (yych <= '/') goto yy83;
		if (yych <= '9') {
			yyt1 = cur;
			goto yy178;
		}
		goto yy83;
	}
yy160:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= ',') {
		if (yych == ' ') goto yy160;
		goto yy83;
	} else {
		if (yych <= '-') {
			yyt1 = cur;
			goto yy179;
		}
		if (yych <= '/') goto yy83;
		if (yych <= '9') {
			yyt1 = cur;
			goto yy180;
		}
		goto yy83;
	}
yy161:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy181;
	goto yy83;
yy162:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= ',') {
		if (yych == ' ') goto yy162;
		goto yy83;
	} else {
		if (yych <= '-') {
			yyt1 = cur;
			goto yy182;
		}
		if (yych <= '/') goto yy83;
		if (yych <= '9') {
			yyt1 = cur;
			goto yy183;
		}
		goto yy83;
	}
yy163:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy83;
	if (yych >= ':') goto yy83;
yy164:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == '.') goto yy185;
	if (yych <= '/') goto yy165;
	if (yych <= '9') goto yy164;
yy165:
	f0 = yyt1;
#line 556 "dvi_special.re2c.c"
	{
      sx = sy = pfloat(f0, lim);
      continue;
    }
#line 1875 "dvi_special.c"
yy166:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy83;
	if (yych >= ':') goto yy83;
yy167:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= 'h') {
		if (yych <= '/') {
			if (yych == '.') goto yy186;
			goto yy83;
		} else {
			if (yych <= '9') goto yy167;
			if (yych == 'c') goto yy187;
			goto yy83;
		}
	} else {
		if (yych <= 'o') {
			if (yych <= 'i') goto yy188;
			if (yych == 'm') goto yy187;
			goto yy83;
		} else {
			if (yych <= 'p') goto yy189;
			if (yych == 't') goto yy190;
			goto yy83;
		}
	}
yy168:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= ',') {
		if (yych == ' ') goto yy168;
		goto yy83;
	} else {
		if (yych <= '-') {
			yyt1 = cur;
			goto yy191;
		}
		if (yych <= '/') goto yy83;
		if (yych <= '9') {
			yyt1 = cur;
			goto yy192;
		}
		goto yy83;
	}
yy169:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= ',') {
		if (yych == ' ') goto yy169;
		goto yy83;
	} else {
		if (yych <= '-') {
			yyt1 = cur;
			goto yy194;
		}
		if (yych <= '/') goto yy83;
		if (yych <= '9') {
			yyt1 = cur;
			goto yy195;
		}
		goto yy83;
	}
yy170:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy83;
	if (yych >= ':') goto yy83;
yy171:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '-') {
		if (yych == ' ') goto yy197;
		goto yy83;
	} else {
		if (yych <= '.') goto yy198;
		if (yych <= '/') goto yy83;
		if (yych <= '9') goto yy171;
		goto yy83;
	}
yy172:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= 'i') {
		if (yych <= 'b') {
			if (yych <= '/') goto yy83;
			if (yych <= '9') goto yy172;
			goto yy83;
		} else {
			if (yych <= 'c') goto yy173;
			if (yych <= 'h') goto yy83;
			goto yy174;
		}
	} else {
		if (yych <= 'o') {
			if (yych != 'm') goto yy83;
		} else {
			if (yych <= 'p') goto yy175;
			if (yych == 't') goto yy176;
			goto yy83;
		}
	}
yy173:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'm') goto yy199;
	goto yy83;
yy174:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'n') goto yy199;
	goto yy83;
yy175:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 't') goto yy199;
	goto yy83;
yy176:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'r') goto yy200;
	goto yy83;
yy177:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy83;
	if (yych >= ':') goto yy83;
yy178:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= 'h') {
		if (yych <= '/') {
			if (yych == '.') goto yy201;
			goto yy83;
		} else {
			if (yych <= '9') goto yy178;
			if (yych == 'c') goto yy202;
			goto yy83;
		}
	} else {
		if (yych <= 'o') {
			if (yych <= 'i') goto yy203;
			if (yych == 'm') goto yy202;
			goto yy83;
		} else {
			if (yych <= 'p') goto yy204;
			if (yych == 't') goto yy205;
			goto yy83;
		}
	}
yy179:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy83;
	if (yych >= ':') goto yy83;
yy180:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '-') {
		if (yych == ' ') goto yy206;
		goto yy83;
	} else {
		if (yych <= '.') goto yy207;
		if (yych <= '/') goto yy83;
		if (yych <= '9') goto yy180;
		goto yy83;
	}
yy181:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= 'b') {
		if (yych <= ' ') {
			if (yych <= 0x1F) goto yy83;
			goto yy181;
		} else {
			if (yych <= '`') goto yy83;
			if (yych <= 'a') {
				yyt1 = cur;
				goto yy208;
			}
			yyt1 = cur;
			goto yy209;
		}
	} else {
		if (yych <= 'm') {
			if (yych <= 'c') {
				yyt1 = cur;
				goto yy210;
			}
			if (yych <= 'l') goto yy83;
			yyt1 = cur;
			goto yy211;
		} else {
			if (yych == 't') {
				yyt1 = cur;
				goto yy212;
			}
			goto yy83;
		}
	}
yy182:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy83;
	if (yych >= ':') goto yy83;
yy183:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == '.') goto yy213;
	if (yych <= '/') goto yy184;
	if (yych <= '9') goto yy183;
yy184:
	f0 = yyt1;
#line 544 "dvi_special.re2c.c"
	{
      r = pfloat(f0, lim);
      continue;
    }
#line 2095 "dvi_special.c"
yy185:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy165;
	if (yych <= '9') goto yy185;
	goto yy165;
yy186:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= 'i') {
		if (yych <= 'b') {
			if (yych <= '/') goto yy83;
			if (yych <= '9') goto yy186;
			goto yy83;
		} else {
			if (yych <= 'c') goto yy187;
			if (yych <= 'h') goto yy83;
			goto yy188;
		}
	} else {
		if (yych <= 'o') {
			if (yych != 'm') goto yy83;
		} else {
			if (yych <= 'p') goto yy189;
			if (yych == 't') goto yy190;
			goto yy83;
		}
	}
yy187:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'm') goto yy214;
	goto yy83;
yy188:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'n') goto yy214;
	goto yy83;
yy189:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 't') goto yy214;
	goto yy83;
yy190:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'r') goto yy215;
	goto yy83;
yy191:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy83;
	if (yych >= ':') goto yy83;
yy192:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == '.') goto yy216;
	if (yych <= '/') goto yy193;
	if (yych <= '9') goto yy192;
yy193:
	f0 = yyt1;
#line 562 "dvi_special.re2c.c"
	{
      sx = pfloat(f0, lim);
      continue;
    }
#line 2162 "dvi_special.c"
yy194:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy83;
	if (yych >= ':') goto yy83;
yy195:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == '.') goto yy217;
	if (yych <= '/') goto yy196;
	if (yych <= '9') goto yy195;
yy196:
	f0 = yyt1;
#line 568 "dvi_special.re2c.c"
	{
      sy = pfloat(f0, lim);
      continue;
    }
#line 2181 "dvi_special.c"
yy197:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= ',') {
		if (yych == ' ') goto yy197;
		goto yy83;
	} else {
		if (yych <= '-') {
			yyt3 = cur;
			goto yy218;
		}
		if (yych <= '/') goto yy83;
		if (yych <= '9') {
			yyt3 = cur;
			goto yy219;
		}
		goto yy83;
	}
yy198:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy197;
	if (yych <= '/') goto yy83;
	if (yych <= '9') goto yy198;
	goto yy83;
yy199:
	++cur;
	f0 = yyt1;
#line 586 "dvi_special.re2c.c"
	{
      xf->depth = pdim(f0, lim);
      continue;
    }
#line 2215 "dvi_special.c"
yy200:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'u') goto yy220;
	goto yy83;
yy201:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= 'i') {
		if (yych <= 'b') {
			if (yych <= '/') goto yy83;
			if (yych <= '9') goto yy201;
			goto yy83;
		} else {
			if (yych <= 'c') goto yy202;
			if (yych <= 'h') goto yy83;
			goto yy203;
		}
	} else {
		if (yych <= 'o') {
			if (yych != 'm') goto yy83;
		} else {
			if (yych <= 'p') goto yy204;
			if (yych == 't') goto yy205;
			goto yy83;
		}
	}
yy202:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'm') goto yy221;
	goto yy83;
yy203:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'n') goto yy221;
	goto yy83;
yy204:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 't') goto yy221;
	goto yy83;
yy205:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'r') goto yy222;
	goto yy83;
yy206:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= ',') {
		if (yych == ' ') goto yy206;
		goto yy83;
	} else {
		if (yych <= '-') {
			yyt2 = cur;
			goto yy223;
		}
		if (yych <= '/') goto yy83;
		if (yych <= '9') {
			yyt2 = cur;
			goto yy224;
		}
		goto yy83;
	}
yy207:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy206;
	if (yych <= '/') goto yy83;
	if (yych <= '9') goto yy207;
	goto yy83;
yy208:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'r') goto yy225;
	goto yy83;
yy209:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'l') goto yy226;
	goto yy83;
yy210:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'r') goto yy227;
	goto yy83;
yy211:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'e') goto yy228;
	goto yy83;
yy212:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'r') goto yy229;
	goto yy83;
yy213:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy184;
	if (yych <= '9') goto yy213;
	goto yy184;
yy214:
	++cur;
	f0 = yyt1;
#line 574 "dvi_special.re2c.c"
	{
      xf->width = pdim(f0, lim);
      continue;
    }
#line 2327 "dvi_special.c"
yy215:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'u') goto yy230;
	goto yy83;
yy216:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy193;
	if (yych <= '9') goto yy216;
	goto yy193;
yy217:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy196;
	if (yych <= '9') goto yy217;
	goto yy196;
yy218:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy83;
	if (yych >= ':') goto yy83;
yy219:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '-') {
		if (yych == ' ') goto yy231;
		goto yy83;
	} else {
		if (yych <= '.') goto yy232;
		if (yych <= '/') goto yy83;
		if (yych <= '9') goto yy219;
		goto yy83;
	}
yy220:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'e') goto yy233;
	goto yy83;
yy221:
	++cur;
	f0 = yyt1;
#line 580 "dvi_special.re2c.c"
	{
      xf->height = pdim(f0, lim);
      continue;
    }
#line 2375 "dvi_special.c"
yy222:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'u') goto yy234;
	goto yy83;
yy223:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy83;
	if (yych >= ':') goto yy83;
yy224:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '-') {
		if (yych == ' ') goto yy235;
		goto yy83;
	} else {
		if (yych <= '.') goto yy236;
		if (yych <= '/') goto yy83;
		if (yych <= '9') goto yy224;
		goto yy83;
	}
yy225:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 't') goto yy237;
	goto yy83;
yy226:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'e') goto yy238;
	goto yy83;
yy227:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'o') goto yy239;
	goto yy83;
yy228:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'd') goto yy240;
	goto yy83;
yy229:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'i') goto yy241;
	goto yy83;
yy230:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'e') goto yy242;
	goto yy83;
yy231:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= ',') {
		if (yych == ' ') goto yy231;
		goto yy83;
	} else {
		if (yych <= '-') {
			yyt4 = cur;
			goto yy243;
		}
		if (yych <= '/') goto yy83;
		if (yych <= '9') {
			yyt4 = cur;
			goto yy244;
		}
		goto yy83;
	}
yy232:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy231;
	if (yych <= '/') goto yy83;
	if (yych <= '9') goto yy232;
	goto yy83;
yy233:
	++cur;
	yych = cur < lim ? *cur : -1;
	switch (yych) {
		case 'c':
		case 'm': goto yy173;
		case 'i': goto yy174;
		case 'p': goto yy175;
		default: goto yy83;
	}
yy234:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'e') goto yy246;
	goto yy83;
yy235:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= ',') {
		if (yych == ' ') goto yy235;
		goto yy83;
	} else {
		if (yych <= '-') {
			yyt3 = cur;
			goto yy247;
		}
		if (yych <= '/') goto yy83;
		if (yych <= '9') {
			yyt3 = cur;
			goto yy248;
		}
		goto yy83;
	}
yy236:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy235;
	if (yych <= '/') goto yy83;
	if (yych <= '9') goto yy236;
	goto yy83;
yy237:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'b') goto yy249;
	goto yy83;
yy238:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'e') goto yy250;
	goto yy83;
yy239:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'p') goto yy237;
	goto yy83;
yy240:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'i') goto yy251;
	goto yy83;
yy241:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'm') goto yy237;
	goto yy83;
yy242:
	++cur;
	yych = cur < lim ? *cur : -1;
	switch (yych) {
		case 'c':
		case 'm': goto yy187;
		case 'i': goto yy188;
		case 'p': goto yy189;
		default: goto yy83;
	}
yy243:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy83;
	if (yych >= ':') goto yy83;
yy244:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == '.') goto yy252;
	if (yych <= '/') goto yy245;
	if (yych <= '9') goto yy244;
yy245:
	f0 = yyt1;
	f1 = yyt2;
	f2 = yyt3;
	f3 = yyt4;
#line 595 "dvi_special.re2c.c"
	{
      xf->bbox.x0 = pfloat(f0, lim);
      xf->bbox.x1 = pfloat(f1, lim);
      xf->bbox.y0 = pfloat(f2, lim);
      xf->bbox.y1 = pfloat(f3, lim);
      continue;
    }
#line 2552 "dvi_special.c"
yy246:
	++cur;
	yych = cur < lim ? *cur : -1;
	switch (yych) {
		case 'c':
		case 'm': goto yy202;
		case 'i': goto yy203;
		case 'p': goto yy204;
		default: goto yy83;
	}
yy247:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy83;
	if (yych >= ':') goto yy83;
yy248:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '-') {
		if (yych == ' ') goto yy253;
		goto yy83;
	} else {
		if (yych <= '.') goto yy254;
		if (yych <= '/') goto yy83;
		if (yych <= '9') goto yy248;
		goto yy83;
	}
yy249:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'o') goto yy255;
	goto yy83;
yy250:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'd') goto yy237;
	goto yy83;
yy251:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'a') goto yy237;
	goto yy83;
yy252:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy245;
	if (yych <= '9') goto yy252;
	goto yy245;
yy253:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= ',') {
		if (yych == ' ') goto yy253;
		goto yy83;
	} else {
		if (yych <= '-') {
			yyt4 = cur;
			goto yy256;
		}
		if (yych <= '/') goto yy83;
		if (yych <= '9') {
			yyt4 = cur;
			goto yy257;
		}
		goto yy83;
	}
yy254:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy253;
	if (yych <= '/') goto yy83;
	if (yych <= '9') goto yy254;
	goto yy83;
yy255:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'x') goto yy258;
	goto yy83;
yy256:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy83;
	if (yych >= ':') goto yy83;
yy257:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '-') {
		if (yych == ' ') goto yy259;
		goto yy83;
	} else {
		if (yych <= '.') goto yy260;
		if (yych <= '/') goto yy83;
		if (yych <= '9') goto yy257;
		goto yy83;
	}
yy258:
	++cur;
	f0 = yyt1;
#line 610 "dvi_special.re2c.c"
	{
      int c = f0[0];
      switch (c)
      {
        case 'm':
          xf->pagebox = BOX_MEDIABOX;
          break;
        case 'c':
          xf->pagebox = BOX_CROPBOX;
          break;
        case 'a':
          xf->pagebox = BOX_ARTBOX;
          break;
        case 'b':
          xf->pagebox = BOX_BLEEDBOX;
          break;
        case 't':
          xf->pagebox = BOX_TRIMBOX;
          break;
      }
      continue;
    }
#line 2674 "dvi_special.c"
yy259:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= ',') {
		if (yych == ' ') goto yy259;
		goto yy83;
	} else {
		if (yych <= '-') {
			yyt5 = cur;
			goto yy261;
		}
		if (yych <= '/') goto yy83;
		if (yych <= '9') {
			yyt5 = cur;
			goto yy262;
		}
		goto yy83;
	}
yy260:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy259;
	if (yych <= '/') goto yy83;
	if (yych <= '9') goto yy260;
	goto yy83;
yy261:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy83;
	if (yych >= ':') goto yy83;
yy262:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '-') {
		if (yych != ' ') goto yy83;
	} else {
		if (yych <= '.') goto yy264;
		if (yych <= '/') goto yy83;
		if (yych <= '9') goto yy262;
		goto yy83;
	}
yy263:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= ',') {
		if (yych == ' ') goto yy263;
		goto yy83;
	} else {
		if (yych <= '-') {
			yyt6 = cur;
			goto yy265;
		}
		if (yych <= '/') goto yy83;
		if (yych <= '9') {
			yyt6 = cur;
			goto yy266;
		}
		goto yy83;
	}
yy264:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy263;
	if (yych <= '/') goto yy83;
	if (yych <= '9') goto yy264;
	goto yy83;
yy265:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy83;
	if (yych >= ':') goto yy83;
yy266:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == '.') goto yy268;
	if (yych <= '/') goto yy267;
	if (yych <= '9') goto yy266;
yy267:
	f0 = yyt1;
	f1 = yyt2;
	f2 = yyt3;
	f3 = yyt4;
	f4 = yyt5;
	f5 = yyt6;
#line 639 "dvi_special.re2c.c"
	{
      xf->ctm.a = pfloat(f0, lim);
      xf->ctm.b = pfloat(f1, lim);
      xf->ctm.c = pfloat(f2, lim);
      xf->ctm.d = pfloat(f3, lim);
      xf->ctm.e = pfloat(f4, lim);
      xf->ctm.f = pfloat(f5, lim);
      continue;
    }
#line 2769 "dvi_special.c"
yy268:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy267;
	if (yych <= '9') goto yy268;
	goto yy267;
}
#line 652 "dvi_special.re2c.c"

  }

  // Not sure about order in which transformations should be applied...

  if (sx != 1.0 || sy != 1.0)
    xf->ctm = fz_pre_scale(xf->ctm, sx, sy);

  if (r)
    xf->ctm = fz_pre_rotate(xf->ctm, r);

  return cur;
}

static bool
pdf_btrans(dvi_context *dc, dvi_state *st, cursor_t cur, cursor_t lim)
{
  if (st->gs_stack.depth >= st->gs_stack.limit)
    return 0;
  st->gs_stack.base[st->gs_stack.depth] = st->gs;
  st->gs_stack.depth += 1;

  st->gs.ctm = dvi_get_ctm(dc, st);
  st->gs.h = st->registers.h;
  st->gs.v = st->registers.v;

  if (cur != lim)
  {
    struct xform_spec xf = xform_spec();
    cur = parse_xform_or_dim(&xf, cur, lim);
    st->gs.ctm = fz_concat(xf.ctm, st->gs.ctm);
  }
  if (cur != lim)
    return unhandled("pdf btrans transformation", cur, lim, 0);
  return 1;
}

static bool
pdf_etrans(dvi_context *dc, dvi_state *st)
{
  if (st->gs_stack.depth == 0)
    return 0;
  st->gs_stack.depth -= 1;
  st->gs = st->gs_stack.base[st->gs_stack.depth];
  return 1;
}

static fz_path *get_path(fz_context *ctx, dvi_context *dc)
{
  if (!dc->path)
    dc->path = fz_new_path(ctx);
  return dc->path;
}

static void drop_path(fz_context *ctx, dvi_context *dc)
{
  if (dc->path)
  {
    fz_drop_path(ctx, dc->path);
    dc->path = NULL;
  }
}

static fz_stroke_state get_stroke_state(fz_context *ctx, dvi_state *st)
{
  fz_stroke_state stst = fz_default_stroke_state;
  stst.linewidth = st->gs.line_width;
  stst.linejoin = (int)st->gs.line_join;
  stst.miterlimit = (int)st->gs.miter_limit;
  stst.dash_cap = stst.start_cap = stst.end_cap = (int)st->gs.line_caps;
  stst.dash_len = st->gs.dash_len;
  memcpy(stst.dash_list, st->gs.dash, sizeof(float) * st->gs.dash_len);
  stst.dash_phase = st->gs.dash_phase;
  return stst;
}

static bool
pdf_code(fz_context *ctx, dvi_context *dc, dvi_state *st, cursor_t cur, cursor_t lim)
{
  vstack *stack = vstack_new(ctx);
  fz_var(cur);
  fz_var(stack);

  // fprintf(stderr, "pdf code: %.*s\n", (int)(lim - cur), cur);
  fz_try(ctx)
  {
    enum PDF_OP op;
    do {
      cursor_t cur0 = cur;
      op = pdf_parse_command(ctx, stack, &cur, lim);
      switch (op)
      {
        case PDF_OP_cm:
        {
          float fmat[6];
          vstack_get_floats(ctx, stack, fmat, 6);
          fz_matrix mat;
          mat.a = fmat[0]; mat.b = fmat[1]; mat.c = fmat[2];
          mat.d = fmat[3]; mat.e = fmat[4]; mat.f = fmat[5];
          fz_matrix ctm = fz_concat(mat, dvi_get_ctm(dc, st));
          dvi_set_ctm(st, ctm);
          break;
        }
        case PDF_OP_q:
        {
          if (st->gs_stack.depth >= st->gs_stack.limit)
            fz_throw(ctx, 0, "PDF q: stack overflow");
          st->gs_stack.base[st->gs_stack.depth] = st->gs;
          st->gs_stack.depth += 1;
          break;
        }
        case PDF_OP_Q:
        {
          if (st->gs_stack.depth == 0)
            fz_throw(ctx, 0, "PDF Q: stack underflow");
          st->gs_stack.depth -= 1;

          int clip_depth0 = st->gs.clip_depth;
          st->gs = st->gs_stack.base[st->gs_stack.depth];
          if (dc->dev)
            for (int i = st->gs.clip_depth; i < clip_depth0; ++i)
              fz_pop_clip(ctx, dc->dev);
          break;
        }
        case PDF_OP_G:
        {
          float c[1];
          vstack_get_floats(ctx, stack, c, 1);
          color_set_gray(st->gs.colors.line, c[0]);
          break;
        }
        case PDF_OP_g:
        {
          float c[1];
          vstack_get_floats(ctx, stack, c, 1);
          color_set_gray(st->gs.colors.fill, c[0]);
          break;
        }
        case PDF_OP_RG:
        {
          float c[3];
          vstack_get_floats(ctx, stack, c, 3);
          color_set_rgb(st->gs.colors.line, c[0], c[1], c[2]);
          break;
        }
        case PDF_OP_rg:
        {
          float c[3];
          vstack_get_floats(ctx, stack, c, 3);
          color_set_rgb(st->gs.colors.fill, c[0], c[1], c[2]);
          break;
        }
        case PDF_OP_K:
        {
          float c[4];
          vstack_get_floats(ctx, stack, c, 4);
          color_set_cmyk(st->gs.colors.line, c[0], c[1], c[2], c[3]);
          break;
        }
        case PDF_OP_k:
        {
          float c[4];
          vstack_get_floats(ctx, stack, c, 4);
          color_set_cmyk(st->gs.colors.fill, c[0], c[1], c[2], c[3]);
          break;
        }

        case PDF_OP_w:
        {
          vstack_get_floats(ctx, stack, &st->gs.line_width, 1);
          break;
        }

        case PDF_OP_j:
        {
          float c[1];
          vstack_get_floats(ctx, stack, c, 1);
          st->gs.line_join = c[0];
          break;
        }

        case PDF_OP_J:
        {
          float c[1];
          vstack_get_floats(ctx, stack, c, 1);
          st->gs.line_caps = c[0];
          break;
        }

        case PDF_OP_M:
        {
          float c[1];
          vstack_get_floats(ctx, stack, c, 1);
          st->gs.miter_limit = c[0];
          break;
        }

        case PDF_OP_m:
        {
          float c[2];
          vstack_get_floats(ctx, stack, c, 2);
          fz_moveto(ctx, get_path(ctx, dc), c[0], c[1]);
          break;
        }

        case PDF_OP_l:
        {
          float c[2];
          vstack_get_floats(ctx, stack, c, 2);
          fz_lineto(ctx, get_path(ctx, dc), c[0], c[1]);
          break;
        }

        case PDF_OP_c:
        {
          float c[6];
          vstack_get_floats(ctx, stack, c, 6);
          fz_curveto(ctx, get_path(ctx, dc), c[0], c[1], c[2], c[3], c[4], c[5]);
          break;
        }

        case PDF_OP_b:
          if (dc->dev)
          {
            fz_matrix ctm = dvi_get_ctm(dc, st);
            fz_stroke_state stst = get_stroke_state(ctx, st);
            fz_path *path = get_path(ctx, dc);
            fz_closepath(ctx, path);
            fz_fill_path(ctx, dc->dev, path, 0, ctm, device_cs(ctx),
                         st->gs.colors.fill, 1.0, color_params);
            fz_stroke_path(ctx, dc->dev, path, &stst, ctm, device_cs(ctx),
                           st->gs.colors.line, 1.0, color_params);
          }
          drop_path(ctx, dc);
          break;

        case PDF_OP_b_star:
          if (dc->dev)
          {
            fz_matrix ctm = dvi_get_ctm(dc, st);
            fz_stroke_state stst = get_stroke_state(ctx, st);
            fz_path *path = get_path(ctx, dc);
            fz_closepath(ctx, path);
            fz_fill_path(ctx, dc->dev, path, 1, ctm, device_cs(ctx),
                         st->gs.colors.fill, 1.0, color_params);
            fz_stroke_path(ctx, dc->dev, path, &stst, ctm, device_cs(ctx),
                           st->gs.colors.line, 1.0, color_params);
          }
          drop_path(ctx, dc);
          break;

        case PDF_OP_B:
          if (dc->dev)
          {
            fz_matrix ctm = dvi_get_ctm(dc, st);
            fz_stroke_state stst = get_stroke_state(ctx, st);
            fz_path *path = get_path(ctx, dc);
            fz_fill_path(ctx, dc->dev, path, 0, ctm, device_cs(ctx),
                         st->gs.colors.fill, 1.0, color_params);
            fz_stroke_path(ctx, dc->dev, path, &stst, ctm, device_cs(ctx),
                           st->gs.colors.line, 1.0, color_params);
          }
          drop_path(ctx, dc);
          break;

        case PDF_OP_B_star:
          if (dc->dev)
          {
            fz_matrix ctm = dvi_get_ctm(dc, st);
            fz_stroke_state stst = get_stroke_state(ctx, st);
            fz_path *path = get_path(ctx, dc);
            fz_fill_path(ctx, dc->dev, path, 1, ctm, device_cs(ctx),
                         st->gs.colors.fill, 1.0, color_params);
            fz_stroke_path(ctx, dc->dev, path, &stst, ctm, device_cs(ctx),
                           st->gs.colors.fill, 1.0, color_params);
          }
          drop_path(ctx, dc);
          break;

        case PDF_OP_f:
        case PDF_OP_F:
          if (dc->dev)
          {
            fz_matrix ctm = dvi_get_ctm(dc, st);
            fz_path *path = get_path(ctx, dc);
            fz_fill_path(ctx, dc->dev, path, 0, ctm, device_cs(ctx),
                         st->gs.colors.fill, 1.0, color_params);
          }
          drop_path(ctx, dc);
          break;

        case PDF_OP_f_star:
          if (dc->dev)
          {
            fz_matrix ctm = dvi_get_ctm(dc, st);
            fz_path *path = get_path(ctx, dc);
            fz_fill_path(ctx, dc->dev, path, 1, ctm, device_cs(ctx),
                         st->gs.colors.fill, 1.0, color_params);
          }
          drop_path(ctx, dc);
          break;

        case PDF_OP_S:
          if (dc->dev)
          {
            fz_matrix ctm = dvi_get_ctm(dc, st);
            fz_stroke_state stst = get_stroke_state(ctx, st);
            fz_path *path = get_path(ctx, dc);
            fz_stroke_path(ctx, dc->dev, path, &stst, ctm, device_cs(ctx),
                           st->gs.colors.line, 1.0, color_params);
          }
          drop_path(ctx, dc);
          break;

        case PDF_OP_s:
          if (dc->dev)
          {
            fz_matrix ctm = dvi_get_ctm(dc, st);
            fz_stroke_state stst = get_stroke_state(ctx, st);
            fz_path *path = get_path(ctx, dc);
            fz_closepath(ctx, path);
            fz_stroke_path(ctx, dc->dev, path, &stst, ctm, device_cs(ctx),
                           st->gs.colors.line, 1.0, color_params);
          }
          drop_path(ctx, dc);
          break;

        case PDF_OP_h:
        {
          fz_path *path = get_path(ctx, dc);
          fz_closepath(ctx, path);
          break;
        }

        case PDF_OP_re:
        {
          float c[4];
          vstack_get_floats(ctx, stack, c, 4);
          fz_rectto(ctx, get_path(ctx, dc), c[0], c[1], c[0] + c[2], c[1] + c[3]);
          break;
        }

        case PDF_OP_n:
        {
          drop_path(ctx, dc);
          break;
        }

        case PDF_OP_W:
          if (dc->dev)
          {
            fz_matrix ctm = dvi_get_ctm(dc, st);
            fz_clip_path(ctx, dc->dev, get_path(ctx, dc), 0, ctm,
                         fz_infinite_rect);
            st->gs.clip_depth += 1;
          }
          break;

        case PDF_OP_W_star:
          if (dc->dev)
          {
            fz_matrix ctm = dvi_get_ctm(dc, st);
            fz_clip_path(ctx, dc->dev, get_path(ctx, dc), 1, ctm,
                         fz_infinite_rect);
            st->gs.clip_depth += 1;
          }
          break;

        case PDF_OP_d:
        {
          val v[2];
          vstack_get_arguments(ctx, stack, v, 2);
          st->gs.dash_len = val_array_length(ctx, stack, v[0]);
          if (st->gs.dash_len > 4) st->gs.dash_len = 4;
          for (int i = 0; i < st->gs.dash_len; ++i)
            st->gs.dash[i] = val_number(ctx, val_array_get(ctx, stack, v[0], i));
          st->gs.dash_phase = val_number(ctx, v[1]);
          break;
        }

        case PDF_OP_ri:
        case PDF_OP_i:
        case PDF_OP_gs:
        case PDF_OP_v:
        case PDF_OP_y:
        case PDF_OP_BT:
        case PDF_OP_ET:
        case PDF_OP_Tc:
        case PDF_OP_Tw:
        case PDF_OP_Tz:
        case PDF_OP_TL:
        case PDF_OP_Tf:
        case PDF_OP_Tr:
        case PDF_OP_Ts:
        case PDF_OP_Td:
        case PDF_OP_TD:
        case PDF_OP_Tm:
        case PDF_OP_T_star:
        case PDF_OP_Tj:
        case PDF_OP_TJ:
        case PDF_OP_squote:
        case PDF_OP_dquote:
        case PDF_OP_d0:
        case PDF_OP_d1:
        case PDF_OP_CS:
        case PDF_OP_cs:
        case PDF_OP_SC:
        case PDF_OP_sc:
        case PDF_OP_SCN:
        case PDF_OP_scn:
        case PDF_OP_sh:
        case PDF_OP_Do:
        case PDF_OP_MP:
        case PDF_OP_DP:
        case PDF_OP_BMC:
        case PDF_OP_BDC:
        case PDF_OP_EMC:
        case PDF_OP_BX:
        case PDF_OP_EX:
        default:
          fprintf(stderr, "pdf unhandled op %s in:\n%.*s\n", pdf_op_name(op),
                  (int)(cur - cur0), cur0);
          break;

        case PDF_NONE:
          break;
      }
    } while (op != PDF_NONE);
  }
  fz_always(ctx)
  {
    vstack_free(ctx, stack);
  }
  fz_catch(ctx)
  {
    return 0;
  }
  return 1;
}

static cursor_t parse_pdf_string(char *buf, char *end, cursor_t cur, cursor_t lim)
{
  if (buf >= end)
    return cur;

  int nesting = 1;
  end -= 1;
  while (cur < lim)
  {
    if (*cur == '(')
      nesting += 1;
    else if (*cur == ')')
    {
      nesting -= 1;
      if (nesting == 0)
        break;
    }
    else if (*cur == '\\')
    {
      cur += 1;
      if (cur >= lim)
        break;
    }
    if (buf < end)
    {
      *buf = *cur;
      buf += 1;
    }
    cur += 1;
  }
  *buf = 0;
  return cur;
}

static bool
dvi_exec_pdf(fz_context *ctx, dvi_context *dc, dvi_state *st, cursor_t cur, cursor_t lim)
{
  cursor_t mar, i, f0, f1, f2, f3, f4, f5, pxform = NULL, pstart, pend;

  
#line 3258 "dvi_special.c"
{
	int yych;
	unsigned int yyaccept = 0;
	static const unsigned char yybm[] = {
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		160,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		 64,  64,  64,  64,  64,  64,  64,  64, 
		 64,  64,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128, 128,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
	};
	mar = cur;
	yych = cur < lim ? *cur : -1;
	switch (yych) {
		case 'b': goto yy271;
		case 'c': goto yy273;
		case 'e': goto yy274;
		case 'i':
			yyt1 = cur;
			goto yy275;
		case 'p': goto yy276;
		default: goto yy270;
	}
yy270:
#line 1195 "dvi_special.re2c.c"
	{ return unhandled("pdf special", cur, lim, 0); }
#line 3311 "dvi_special.c"
yy271:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= 'd') {
		if (yych == 'c') goto yy277;
	} else {
		if (yych <= 'e') goto yy278;
		if (yych == 't') goto yy279;
	}
yy272:
	cur = mar;
	if (yyaccept <= 1) {
		if (yyaccept == 0) {
			goto yy270;
		} else {
			goto yy280;
		}
	} else {
		if (yyaccept == 2) {
			goto yy283;
		} else {
			goto yy286;
		}
	}
yy273:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'o') goto yy281;
	goto yy272;
yy274:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= 'm') {
		if (yych == 'c') goto yy282;
		goto yy272;
	} else {
		if (yych <= 'n') goto yy284;
		if (yych == 't') goto yy285;
		goto yy272;
	}
yy275:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'm') goto yy287;
	goto yy272;
yy276:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'a') goto yy288;
	goto yy272;
yy277:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'o') goto yy294;
	goto yy290;
yy278:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'g') goto yy295;
	goto yy272;
yy279:
	yyaccept = 1;
	++cur;
	mar = cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'r') goto yy298;
	goto yy297;
yy280:
#line 1159 "dvi_special.re2c.c"
	{ return pdf_btrans(dc, st, cur, lim); }
#line 3382 "dvi_special.c"
yy281:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'd') goto yy299;
	goto yy272;
yy282:
	yyaccept = 2;
	++cur;
	mar = cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'o') goto yy300;
yy283:
#line 1187 "dvi_special.re2c.c"
	{
    return colorstack_pop(ctx, dc, st, -1);
  }
#line 3399 "dvi_special.c"
yy284:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'd') goto yy301;
	goto yy272;
yy285:
	yyaccept = 3;
	++cur;
	mar = cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'r') goto yy302;
yy286:
#line 1162 "dvi_special.re2c.c"
	{ return pdf_etrans(dc, st); }
#line 3414 "dvi_special.c"
yy287:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'a') goto yy303;
	goto yy272;
yy288:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'g') goto yy304;
	goto yy272;
yy289:
	++cur;
	yych = cur < lim ? *cur : -1;
yy290:
	if (yybm[0+yych] & 32) {
		goto yy289;
	}
	if (yych <= '/') {
		if (yych != '-') goto yy272;
		yyt1 = cur;
	} else {
		if (yych <= '9') {
			yyt1 = cur;
			goto yy291;
		}
		if (yych == '[') goto yy293;
		goto yy272;
	}
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yybm[0+yych] & 64) {
		goto yy291;
	}
	goto yy272;
yy291:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yybm[0+yych] & 64) {
		goto yy291;
	}
	if (yych == '.') goto yy305;
	yyt2 = NULL;
	yyt3 = NULL;
	yyt4 = NULL;
	yyt5 = NULL;
yy292:
	f4 = yyt1;
	f0 = yyt2;
	f1 = yyt3;
	f2 = yyt4;
	f3 = yyt5;
#line 1174 "dvi_special.re2c.c"
	{
    if (!colorstack_push(ctx, dc, st, -1))
      return 0;
    if (f3)
      color_set_cmyk(st->gs.colors.fill, pfloat(f0, lim), pfloat(f1, lim), pfloat(f2, lim), pfloat(f3, lim));
    else if (f1)
      color_set_rgb(st->gs.colors.fill, pfloat(f0, lim), pfloat(f1, lim), pfloat(f2, lim));
    else
      color_set_gray(st->gs.colors.fill, pfloat(f4 ? f4 : f0, lim));
    return 1;
  }
#line 3478 "dvi_special.c"
yy293:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= ',') {
		if (yych == ' ') goto yy293;
		goto yy272;
	} else {
		if (yych <= '-') {
			yyt2 = cur;
			goto yy306;
		}
		if (yych <= '/') goto yy272;
		if (yych <= '9') {
			yyt2 = cur;
			goto yy307;
		}
		goto yy272;
	}
yy294:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'l') goto yy308;
	if (yych == 'n') goto yy309;
	goto yy272;
yy295:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'i') goto yy310;
	goto yy272;
yy296:
	++cur;
	yych = cur < lim ? *cur : -1;
yy297:
	if (yych == ' ') goto yy296;
	goto yy280;
yy298:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'a') goto yy311;
	goto yy272;
yy299:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'e') goto yy312;
	goto yy272;
yy300:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'l') goto yy313;
	if (yych == 'n') goto yy309;
	goto yy272;
yy301:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'c') goto yy314;
	if (yych == 't') goto yy315;
	goto yy272;
yy302:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'a') goto yy316;
	goto yy272;
yy303:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'g') goto yy317;
	goto yy272;
yy304:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'e') goto yy318;
	goto yy272;
yy305:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') {
		yyt2 = NULL;
		yyt3 = NULL;
		yyt4 = NULL;
		yyt5 = NULL;
		goto yy292;
	}
	if (yych <= '9') goto yy305;
	yyt2 = NULL;
	yyt3 = NULL;
	yyt4 = NULL;
	yyt5 = NULL;
	goto yy292;
yy306:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy272;
	if (yych >= ':') goto yy272;
yy307:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '.') {
		if (yych == ' ') {
			yyt3 = NULL;
			yyt4 = NULL;
			yyt5 = NULL;
			goto yy319;
		}
		if (yych <= '-') goto yy272;
		goto yy320;
	} else {
		if (yych <= '9') {
			if (yych <= '/') goto yy272;
			goto yy307;
		} else {
			if (yych == ']') {
				yyt3 = NULL;
				yyt4 = NULL;
				yyt5 = NULL;
				goto yy321;
			}
			goto yy272;
		}
	}
yy308:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'o') goto yy322;
	goto yy272;
yy309:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 't') goto yy323;
	goto yy272;
yy310:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'n') goto yy324;
	goto yy272;
yy311:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'n') goto yy325;
	goto yy272;
yy312:
	++cur;
#line 1192 "dvi_special.re2c.c"
	{ return pdf_code(ctx, dc, st, cur, lim); }
#line 3622 "dvi_special.c"
yy313:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'o') goto yy326;
	goto yy272;
yy314:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'o') goto yy327;
	goto yy272;
yy315:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'r') goto yy328;
	goto yy272;
yy316:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'n') goto yy329;
	goto yy272;
yy317:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'e') goto yy330;
	goto yy272;
yy318:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 's') goto yy331;
	goto yy272;
yy319:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '-') {
		if (yych == ' ') goto yy319;
		if (yych <= ',') goto yy272;
		yyt3 = cur;
		goto yy332;
	} else {
		if (yych <= '9') {
			if (yych <= '/') goto yy272;
			yyt3 = cur;
			goto yy333;
		} else {
			if (yych == ']') goto yy321;
			goto yy272;
		}
	}
yy320:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') {
		if (yych == ' ') {
			yyt3 = NULL;
			yyt4 = NULL;
			yyt5 = NULL;
			goto yy319;
		}
		goto yy272;
	} else {
		if (yych <= '9') goto yy320;
		if (yych != ']') goto yy272;
		yyt3 = NULL;
		yyt4 = NULL;
		yyt5 = NULL;
	}
yy321:
	++cur;
	yyt1 = NULL;
	goto yy292;
yy322:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'r') goto yy289;
	goto yy272;
yy323:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'e') goto yy334;
	goto yy272;
yy324:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'c') goto yy335;
	if (yych == 't') goto yy336;
	goto yy272;
yy325:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 's') goto yy296;
	goto yy272;
yy326:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'r') goto yy337;
	goto yy272;
yy327:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'l') goto yy313;
	goto yy272;
yy328:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'a') goto yy338;
	goto yy272;
yy329:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 's') goto yy339;
	goto yy272;
yy330:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy340;
	goto yy272;
yy331:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'i') goto yy341;
	goto yy272;
yy332:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy272;
	if (yych >= ':') goto yy272;
yy333:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '-') {
		if (yych == ' ') goto yy342;
		goto yy272;
	} else {
		if (yych <= '.') goto yy343;
		if (yych <= '/') goto yy272;
		if (yych <= '9') goto yy333;
		goto yy272;
	}
yy334:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'n') goto yy344;
	goto yy272;
yy335:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'o') goto yy345;
	goto yy272;
yy336:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'r') goto yy346;
	goto yy272;
yy337:
	++cur;
	goto yy283;
yy338:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'n') goto yy347;
	goto yy272;
yy339:
	++cur;
	goto yy286;
yy340:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= ',') {
		if (yych <= ' ') {
			if (yych <= 0x1F) goto yy272;
			goto yy340;
		} else {
			if (yych == '(') {
				yyt2 = cur;
				goto yy348;
			}
			goto yy272;
		}
	} else {
		if (yych <= '9') {
			if (yych <= '-') {
				yyt2 = cur;
				goto yy349;
			}
			if (yych <= '/') goto yy272;
			yyt2 = cur;
			goto yy350;
		} else {
			if (yych <= '`') goto yy272;
			if (yych <= 'z') {
				yyt2 = cur;
				goto yy351;
			}
			goto yy272;
		}
	}
yy341:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'z') goto yy352;
	goto yy272;
yy342:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= ',') {
		if (yych == ' ') goto yy342;
		goto yy272;
	} else {
		if (yych <= '-') {
			yyt4 = cur;
			goto yy353;
		}
		if (yych <= '/') goto yy272;
		if (yych <= '9') {
			yyt4 = cur;
			goto yy354;
		}
		goto yy272;
	}
yy343:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy342;
	if (yych <= '/') goto yy272;
	if (yych <= '9') goto yy343;
	goto yy272;
yy344:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 't') goto yy355;
	goto yy272;
yy345:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'l') goto yy308;
	goto yy272;
yy346:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'a') goto yy356;
	goto yy272;
yy347:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 's') goto yy357;
	goto yy272;
yy348:
	++cur;
	f0 = yyt1;
	pxform = yyt2;
	pstart = cur;
	pstart += -1;
#line 1141 "dvi_special.re2c.c"
	{
    struct xform_spec xf = xform_spec();
    pxform = parse_xform_or_dim(&xf, pxform, pstart);
    if (pxform != pstart)
      fprintf(stderr, "pdf unhandled transformation: %.*s\n",
              (int)(pstart - pxform), pxform);
    char filename[2048];
    cur = parse_pdf_string(filename, filename + 2048, cur, lim);
    if (!embed_graphics(ctx, dc, st, &xf, filename))
    {
      fprintf(stderr, "error rendering image: %.*s", (int)(lim-f0), f0);
      return 0;
    }
    else
      return 1;
  }
#line 3892 "dvi_special.c"
yy349:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy272;
	if (yych >= ':') goto yy272;
yy350:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '-') {
		if (yych <= '\'') {
			if (yych != ' ') goto yy272;
		} else {
			if (yych <= '(') goto yy348;
			if (yych <= ',') goto yy272;
			goto yy349;
		}
	} else {
		if (yych <= '9') {
			if (yych <= '.') goto yy351;
			if (yych <= '/') goto yy272;
			goto yy350;
		} else {
			if (yych <= '`') goto yy272;
			if (yych >= '{') goto yy272;
		}
	}
yy351:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yybm[0+yych] & 128) {
		goto yy351;
	}
	if (yych <= ',') {
		if (yych == '(') goto yy348;
		goto yy272;
	} else {
		if (yych <= '-') goto yy349;
		if (yych <= '/') goto yy272;
		if (yych <= '9') goto yy350;
		goto yy272;
	}
yy352:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'e') goto yy358;
	goto yy272;
yy353:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy272;
	if (yych >= ':') goto yy272;
yy354:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '.') {
		if (yych == ' ') {
			yyt5 = NULL;
			goto yy359;
		}
		if (yych <= '-') goto yy272;
		goto yy360;
	} else {
		if (yych <= '9') {
			if (yych <= '/') goto yy272;
			goto yy354;
		} else {
			if (yych == ']') {
				yyt5 = NULL;
				goto yy321;
			}
			goto yy272;
		}
	}
yy355:
	++cur;
	f0 = cur;
	f0 += -8;
	f1 = cur;
#line 1165 "dvi_special.re2c.c"
	{
    if (f1 != lim)
      fprintf(stderr, "unhandled pdf content: %.*s\n",
              (int)(lim - f0), f0);
    return 1;
  }
#line 3978 "dvi_special.c"
yy356:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'n') goto yy361;
	goto yy272;
yy357:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'f') goto yy362;
	goto yy272;
yy358:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy363;
	goto yy272;
yy359:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '-') {
		if (yych == ' ') goto yy359;
		if (yych <= ',') goto yy272;
		yyt5 = cur;
		goto yy364;
	} else {
		if (yych <= '9') {
			if (yych <= '/') goto yy272;
			yyt5 = cur;
			goto yy365;
		} else {
			if (yych == ']') goto yy321;
			goto yy272;
		}
	}
yy360:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') {
		if (yych == ' ') {
			yyt5 = NULL;
			goto yy359;
		}
		goto yy272;
	} else {
		if (yych <= '9') goto yy360;
		if (yych == ']') {
			yyt5 = NULL;
			goto yy321;
		}
		goto yy272;
	}
yy361:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 's') goto yy366;
	goto yy272;
yy362:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'o') goto yy367;
	goto yy272;
yy363:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= 'c') {
		if (yych == ' ') goto yy363;
		goto yy272;
	} else {
		if (yych <= 'd') goto yy368;
		if (yych == 'w') goto yy369;
		goto yy272;
	}
yy364:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy272;
	if (yych >= ':') goto yy272;
yy365:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '.') {
		if (yych == ' ') goto yy370;
		if (yych <= '-') goto yy272;
		goto yy371;
	} else {
		if (yych <= '9') {
			if (yych <= '/') goto yy272;
			goto yy365;
		} else {
			if (yych == ']') goto yy321;
			goto yy272;
		}
	}
yy366:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'f') goto yy372;
	goto yy272;
yy367:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'r') goto yy373;
	goto yy272;
yy368:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'e') goto yy374;
	goto yy272;
yy369:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'i') goto yy375;
	goto yy272;
yy370:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy370;
	if (yych == ']') goto yy321;
	goto yy272;
yy371:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') {
		if (yych == ' ') goto yy370;
		goto yy272;
	} else {
		if (yych <= '9') goto yy371;
		if (yych == ']') goto yy321;
		goto yy272;
	}
yy372:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'o') goto yy376;
	goto yy272;
yy373:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'm') goto yy339;
	goto yy272;
yy374:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'f') goto yy377;
	goto yy272;
yy375:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'd') goto yy378;
	goto yy272;
yy376:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'r') goto yy379;
	goto yy272;
yy377:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'a') goto yy380;
	goto yy272;
yy378:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 't') goto yy381;
	goto yy272;
yy379:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'm') goto yy296;
	goto yy272;
yy380:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'u') goto yy382;
	goto yy272;
yy381:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'h') goto yy383;
	goto yy272;
yy382:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'l') goto yy384;
	goto yy272;
yy383:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy385;
	goto yy272;
yy384:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 't') goto yy386;
	goto yy272;
yy385:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= ',') {
		if (yych == ' ') goto yy385;
		goto yy272;
	} else {
		if (yych <= '-') {
			yyt1 = cur;
			goto yy387;
		}
		if (yych <= '/') goto yy272;
		if (yych <= '9') {
			yyt1 = cur;
			goto yy388;
		}
		goto yy272;
	}
yy386:
	++cur;
#line 1138 "dvi_special.re2c.c"
	{ return 1; }
#line 4195 "dvi_special.c"
yy387:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy272;
	if (yych >= ':') goto yy272;
yy388:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= 'h') {
		if (yych <= '/') {
			if (yych != '.') goto yy272;
		} else {
			if (yych <= '9') goto yy388;
			if (yych == 'c') goto yy390;
			goto yy272;
		}
	} else {
		if (yych <= 'o') {
			if (yych <= 'i') goto yy391;
			if (yych == 'm') goto yy390;
			goto yy272;
		} else {
			if (yych <= 'p') goto yy392;
			if (yych == 't') goto yy393;
			goto yy272;
		}
	}
yy389:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= 'i') {
		if (yych <= 'b') {
			if (yych <= '/') goto yy272;
			if (yych <= '9') goto yy389;
			goto yy272;
		} else {
			if (yych <= 'c') goto yy390;
			if (yych <= 'h') goto yy272;
			goto yy391;
		}
	} else {
		if (yych <= 'o') {
			if (yych != 'm') goto yy272;
		} else {
			if (yych <= 'p') goto yy392;
			if (yych == 't') goto yy393;
			goto yy272;
		}
	}
yy390:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'm') goto yy394;
	goto yy272;
yy391:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'n') goto yy394;
	goto yy272;
yy392:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 't') goto yy394;
	goto yy272;
yy393:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'r') goto yy395;
	goto yy272;
yy394:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy396;
	goto yy272;
yy395:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'u') goto yy397;
	goto yy272;
yy396:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy396;
	if (yych == 'h') goto yy398;
	goto yy272;
yy397:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'e') goto yy399;
	goto yy272;
yy398:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'e') goto yy400;
	goto yy272;
yy399:
	++cur;
	yych = cur < lim ? *cur : -1;
	switch (yych) {
		case 'c':
		case 'm': goto yy390;
		case 'i': goto yy391;
		case 'p': goto yy392;
		default: goto yy272;
	}
yy400:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'i') goto yy272;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'g') goto yy272;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'h') goto yy272;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 't') goto yy272;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != ' ') goto yy272;
yy401:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= ',') {
		if (yych == ' ') goto yy401;
		goto yy272;
	} else {
		if (yych <= '-') {
			yyt2 = cur;
			goto yy402;
		}
		if (yych <= '/') goto yy272;
		if (yych <= '9') {
			yyt2 = cur;
			goto yy403;
		}
		goto yy272;
	}
yy402:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy272;
	if (yych >= ':') goto yy272;
yy403:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= 'h') {
		if (yych <= '/') {
			if (yych != '.') goto yy272;
		} else {
			if (yych <= '9') goto yy403;
			if (yych == 'c') goto yy405;
			goto yy272;
		}
	} else {
		if (yych <= 'o') {
			if (yych <= 'i') goto yy406;
			if (yych == 'm') goto yy405;
			goto yy272;
		} else {
			if (yych <= 'p') goto yy407;
			if (yych == 't') goto yy408;
			goto yy272;
		}
	}
yy404:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= 'i') {
		if (yych <= 'b') {
			if (yych <= '/') goto yy272;
			if (yych <= '9') goto yy404;
			goto yy272;
		} else {
			if (yych <= 'c') goto yy405;
			if (yych <= 'h') goto yy272;
			goto yy406;
		}
	} else {
		if (yych <= 'o') {
			if (yych != 'm') goto yy272;
		} else {
			if (yych <= 'p') goto yy407;
			if (yych == 't') goto yy408;
			goto yy272;
		}
	}
yy405:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'm') goto yy409;
	goto yy272;
yy406:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'n') goto yy409;
	goto yy272;
yy407:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 't') goto yy409;
	goto yy272;
yy408:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'r') goto yy410;
	goto yy272;
yy409:
	++cur;
	f0 = yyt1;
	f1 = yyt2;
#line 1135 "dvi_special.re2c.c"
	{ return 1; }
#line 4410 "dvi_special.c"
yy410:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'u') goto yy272;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'e') goto yy272;
	++cur;
	yych = cur < lim ? *cur : -1;
	switch (yych) {
		case 'c':
		case 'm': goto yy405;
		case 'i': goto yy406;
		case 'p': goto yy407;
		default: goto yy272;
	}
}
#line 1197 "dvi_special.re2c.c"

}

bool dvi_exec_special(fz_context *ctx, dvi_context *dc, dvi_state *st, cursor_t cur, cursor_t lim)
{
  cursor_t mar, i, j;

  // fprintf(stderr, "special: %.*s\n", (int)(lim - cur), cur);

  for (;;)
  {
    
#line 4441 "dvi_special.c"
{
	int yych;
	static const unsigned char yybm[] = {
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		 64,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
	};
	mar = cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= 'k') {
		if (yych <= ' ') {
			if (yych >= ' ') goto yy413;
		} else {
			if (yych == 'c') goto yy414;
		}
	} else {
		if (yych <= 'p') {
			if (yych <= 'l') goto yy416;
			if (yych >= 'p') goto yy417;
		} else {
			if (yych == 'x') goto yy418;
		}
	}
yy412:
#line 1261 "dvi_special.re2c.c"
	{ return unhandled("special", cur, lim, 0); }
#line 4497 "dvi_special.c"
yy413:
	++cur;
#line 1211 "dvi_special.re2c.c"
	{ continue; }
#line 4502 "dvi_special.c"
yy414:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'o') goto yy419;
yy415:
	cur = mar;
	goto yy412;
yy416:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'a') goto yy420;
	goto yy415;
yy417:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'd') goto yy421;
	goto yy415;
yy418:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ':') goto yy422;
	goto yy415;
yy419:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'l') goto yy423;
	goto yy415;
yy420:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'n') goto yy424;
	goto yy415;
yy421:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'f') goto yy425;
	goto yy415;
yy422:
	++cur;
#line 1248 "dvi_special.re2c.c"
	{
      struct xform_spec xf = xform_spec();
      cur = parse_xform_or_dim(&xf, cur, lim);
      st->gs.ctm = fz_concat(xf.ctm, st->gs.ctm);
      if (cur < lim)
        return unhandled("pdf x", cur, lim, 0);
      return 1;
    }
#line 4551 "dvi_special.c"
yy423:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'o') goto yy426;
	goto yy415;
yy424:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'd') goto yy427;
	goto yy415;
yy425:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ':') goto yy428;
	if (yych == 'c') goto yy429;
	goto yy415;
yy426:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'r') goto yy430;
	goto yy415;
yy427:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 's') goto yy431;
	goto yy415;
yy428:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yybm[0+yych] & 64) {
		goto yy428;
	}
#line 1258 "dvi_special.re2c.c"
	{ return dvi_exec_pdf(ctx, dc, st, cur, lim); }
#line 4586 "dvi_special.c"
yy429:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'o') goto yy432;
	goto yy415;
yy430:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy433;
	goto yy415;
yy431:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'c') goto yy434;
	goto yy415;
yy432:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'l') goto yy435;
	goto yy415;
yy433:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy433;
	if (yych == 'p') goto yy436;
	goto yy415;
yy434:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'a') goto yy437;
	goto yy415;
yy435:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'o') goto yy438;
	goto yy415;
yy436:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'o') goto yy439;
	if (yych == 'u') goto yy440;
	goto yy415;
yy437:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'p') goto yy441;
	goto yy415;
yy438:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'r') goto yy442;
	goto yy415;
yy439:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'p') goto yy443;
	goto yy415;
yy440:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 's') goto yy444;
	goto yy415;
yy441:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'e') goto yy445;
	goto yy415;
yy442:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 's') goto yy446;
	goto yy415;
yy443:
	++cur;
#line 1239 "dvi_special.re2c.c"
	{ return colorstack_pop(ctx, dc, st, -1); }
#line 4663 "dvi_special.c"
yy444:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'h') goto yy447;
	goto yy415;
yy445:
	++cur;
#line 1214 "dvi_special.re2c.c"
	{ return 1; }
#line 4673 "dvi_special.c"
yy446:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 't') goto yy448;
	goto yy415;
yy447:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy449;
	goto yy415;
yy448:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'a') goto yy450;
	goto yy415;
yy449:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy449;
#line 1242 "dvi_special.re2c.c"
	{
      return colorstack_push(ctx, dc, st, -1) &&
             parse_color(&st->gs.colors, cur, lim);
    }
#line 4698 "dvi_special.c"
yy450:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'c') goto yy415;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'k') goto yy415;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy451;
	if (yych == 'i') goto yy452;
	goto yy415;
yy451:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy451;
	if (yych <= '/') goto yy415;
	if (yych <= '9') {
		yyt1 = cur;
		goto yy453;
	}
	goto yy415;
yy452:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'n') goto yy454;
	goto yy415;
yy453:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yybm[0+yych] & 128) {
		goto yy453;
	}
	if (yych == ' ') goto yy455;
	goto yy415;
yy454:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'i') goto yy456;
	goto yy415;
yy455:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= 'b') {
		if (yych == ' ') goto yy455;
		goto yy415;
	} else {
		if (yych <= 'c') goto yy457;
		if (yych == 'p') goto yy458;
		goto yy415;
	}
yy456:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 't') goto yy459;
	goto yy415;
yy457:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'u') goto yy460;
	goto yy415;
yy458:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'o') goto yy461;
	if (yych == 'u') goto yy462;
	goto yy415;
yy459:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy463;
	goto yy415;
yy460:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'r') goto yy464;
	goto yy415;
yy461:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'p') goto yy465;
	goto yy415;
yy462:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 's') goto yy466;
	goto yy415;
yy463:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy463;
	if (yych <= '/') goto yy415;
	if (yych <= '9') {
		yyt1 = cur;
		goto yy467;
	}
	goto yy415;
yy464:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'r') goto yy468;
	goto yy415;
yy465:
	++cur;
	i = yyt1;
#line 1222 "dvi_special.re2c.c"
	{ return colorstack_pop(ctx, dc, st, pint(i, lim)); }
#line 4806 "dvi_special.c"
yy466:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'h') goto yy469;
	goto yy415;
yy467:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy470;
	if (yych <= '/') goto yy415;
	if (yych <= '9') goto yy467;
	goto yy415;
yy468:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'e') goto yy471;
	goto yy415;
yy469:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy472;
	goto yy415;
yy470:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy470;
	if (yych == 'p') goto yy473;
	goto yy415;
yy471:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'n') goto yy474;
	goto yy415;
yy472:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy472;
	if (yych == '(') goto yy475;
	goto yy415;
yy473:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'a') goto yy476;
	goto yy415;
yy474:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 't') goto yy477;
	goto yy415;
yy475:
	++cur;
	i = yyt1;
#line 1226 "dvi_special.re2c.c"
	{
      return colorstack_push(ctx, dc, st, pint(i, lim)) &&
             parse_pdfcolor(&st->gs.colors, cur, lim);
    }
#line 4864 "dvi_special.c"
yy476:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'g') goto yy478;
	goto yy415;
yy477:
	++cur;
	i = yyt1;
#line 1218 "dvi_special.re2c.c"
	{ return pdfcolorstack_current(ctx, dc, st, pint(i, lim)); }
#line 4875 "dvi_special.c"
yy478:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'e') goto yy415;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != ' ') goto yy415;
yy479:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy479;
	if (yych != 'd') goto yy415;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'i') goto yy415;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'r') goto yy415;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'e') goto yy415;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'c') goto yy415;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 't') goto yy415;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != ' ') goto yy415;
yy480:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy480;
	if (yych != '(') goto yy415;
	++cur;
	i = yyt1;
#line 1233 "dvi_special.re2c.c"
	{
      return colorstack_init(ctx, dc, st, pint(i, lim)) &&
             parse_pdfcolor(&st->gs.colors, cur, lim);
    }
#line 4918 "dvi_special.c"
}
#line 1263 "dvi_special.re2c.c"

  }
}

bool dvi_init_special(fz_context *ctx, dvi_context *dc, dvi_state *st, cursor_t cur, cursor_t lim)
{
  cursor_t i, f0, f1, mar;

  
#line 4930 "dvi_special.c"
{
	int yych;
	static const unsigned char yybm[] = {
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		 64,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
	};
	mar = cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'p') goto yy483;
yy482:
#line 1281 "dvi_special.re2c.c"
	{ return 0; }
#line 4973 "dvi_special.c"
yy483:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'd') goto yy485;
yy484:
	cur = mar;
	goto yy482;
yy485:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'f') goto yy484;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'c') goto yy484;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'o') goto yy484;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'l') goto yy484;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'o') goto yy484;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'r') goto yy484;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 's') goto yy484;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 't') goto yy484;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'a') goto yy484;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'c') goto yy484;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'k') goto yy484;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'i') goto yy484;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'n') goto yy484;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'i') goto yy484;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 't') goto yy484;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yybm[0+yych] & 64) {
		goto yy486;
	}
	goto yy484;
yy486:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yybm[0+yych] & 64) {
		goto yy486;
	}
	if (yych <= '/') goto yy484;
	if (yych >= ':') goto yy484;
	yyt1 = cur;
yy487:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yybm[0+yych] & 128) {
		goto yy487;
	}
	if (yych != ' ') goto yy484;
yy488:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy488;
	if (yych != 'p') goto yy484;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'a') goto yy484;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'g') goto yy484;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'e') goto yy484;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != ' ') goto yy484;
yy489:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy489;
	if (yych != 'd') goto yy484;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'i') goto yy484;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'r') goto yy484;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'e') goto yy484;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'c') goto yy484;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 't') goto yy484;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != ' ') goto yy484;
yy490:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy490;
	if (yych != '(') goto yy484;
	++cur;
	i = yyt1;
#line 1275 "dvi_special.re2c.c"
	{
    return colorstack_init(ctx, dc, st, pint(i, lim)) &&
           parse_pdfcolor(&st->gs.colors, cur, lim);
  }
#line 5101 "dvi_special.c"
}
#line 1283 "dvi_special.re2c.c"

}

void dvi_prescan_special(cursor_t cur, cursor_t lim, float *width, float *height, bool *landscape)
{
  cursor_t f0, f1, mar;

  // fprintf(stderr, "prescan: %.*s\n", (int)(lim - cur), cur);

  
#line 5114 "dvi_special.c"
{
	int yych;
	static const unsigned char yybm[] = {
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		 64,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		128, 128, 128, 128, 128, 128, 128, 128, 
		128, 128,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
		  0,   0,   0,   0,   0,   0,   0,   0, 
	};
	mar = cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'l') goto yy493;
	if (yych == 'p') goto yy495;
yy492:
#line 1312 "dvi_special.re2c.c"
	{ return; }
#line 5158 "dvi_special.c"
yy493:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'a') goto yy496;
yy494:
	cur = mar;
	goto yy492;
yy495:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'd') goto yy497;
	goto yy494;
yy496:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'n') goto yy498;
	goto yy494;
yy497:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'f') goto yy499;
	goto yy494;
yy498:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'd') goto yy500;
	goto yy494;
yy499:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ':') goto yy501;
	goto yy494;
yy500:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 's') goto yy502;
	goto yy494;
yy501:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yybm[0+yych] & 64) {
		goto yy501;
	}
	if (yych == 'p') goto yy503;
	goto yy494;
yy502:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'c') goto yy504;
	goto yy494;
yy503:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'a') goto yy505;
	goto yy494;
yy504:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'a') goto yy506;
	goto yy494;
yy505:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'g') goto yy507;
	goto yy494;
yy506:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'p') goto yy508;
	goto yy494;
yy507:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'e') goto yy509;
	goto yy494;
yy508:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'e') goto yy510;
	goto yy494;
yy509:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 's') goto yy511;
	goto yy494;
yy510:
	++cur;
#line 1295 "dvi_special.re2c.c"
	{
    *landscape = 1;
    return;
  }
#line 5251 "dvi_special.c"
yy511:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'i') goto yy494;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'z') goto yy494;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'e') goto yy494;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != ' ') goto yy494;
yy512:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= 'c') {
		if (yych == ' ') goto yy512;
		goto yy494;
	} else {
		if (yych <= 'd') goto yy513;
		if (yych == 'w') goto yy514;
		goto yy494;
	}
yy513:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'e') goto yy515;
	goto yy494;
yy514:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'i') goto yy516;
	goto yy494;
yy515:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'f') goto yy517;
	goto yy494;
yy516:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'd') goto yy518;
	goto yy494;
yy517:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'a') goto yy519;
	goto yy494;
yy518:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 't') goto yy520;
	goto yy494;
yy519:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'u') goto yy521;
	goto yy494;
yy520:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'h') goto yy522;
	goto yy494;
yy521:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'l') goto yy523;
	goto yy494;
yy522:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy524;
	goto yy494;
yy523:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 't') goto yy525;
	goto yy494;
yy524:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= ',') {
		if (yych == ' ') goto yy524;
		goto yy494;
	} else {
		if (yych <= '-') {
			yyt1 = cur;
			goto yy526;
		}
		if (yych <= '/') goto yy494;
		if (yych <= '9') {
			yyt1 = cur;
			goto yy527;
		}
		goto yy494;
	}
yy525:
	++cur;
#line 1309 "dvi_special.re2c.c"
	{ *width = 612; *height = 792; return; }
#line 5353 "dvi_special.c"
yy526:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yybm[0+yych] & 128) {
		goto yy527;
	}
	goto yy494;
yy527:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yybm[0+yych] & 128) {
		goto yy527;
	}
	if (yych <= 'i') {
		if (yych <= 'b') {
			if (yych != '.') goto yy494;
		} else {
			if (yych <= 'c') goto yy529;
			if (yych <= 'h') goto yy494;
			goto yy530;
		}
	} else {
		if (yych <= 'o') {
			if (yych == 'm') goto yy529;
			goto yy494;
		} else {
			if (yych <= 'p') goto yy531;
			if (yych == 't') goto yy532;
			goto yy494;
		}
	}
yy528:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= 'i') {
		if (yych <= 'b') {
			if (yych <= '/') goto yy494;
			if (yych <= '9') goto yy528;
			goto yy494;
		} else {
			if (yych <= 'c') goto yy529;
			if (yych <= 'h') goto yy494;
			goto yy530;
		}
	} else {
		if (yych <= 'o') {
			if (yych != 'm') goto yy494;
		} else {
			if (yych <= 'p') goto yy531;
			if (yych == 't') goto yy532;
			goto yy494;
		}
	}
yy529:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'm') goto yy533;
	goto yy494;
yy530:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'n') goto yy533;
	goto yy494;
yy531:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 't') goto yy533;
	goto yy494;
yy532:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'r') goto yy534;
	goto yy494;
yy533:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy535;
	goto yy494;
yy534:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'u') goto yy536;
	goto yy494;
yy535:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == ' ') goto yy535;
	if (yych == 'h') goto yy537;
	goto yy494;
yy536:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'e') goto yy538;
	goto yy494;
yy537:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'e') goto yy539;
	goto yy494;
yy538:
	++cur;
	yych = cur < lim ? *cur : -1;
	switch (yych) {
		case 'c':
		case 'm': goto yy529;
		case 'i': goto yy530;
		case 'p': goto yy531;
		default: goto yy494;
	}
yy539:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'i') goto yy494;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'g') goto yy494;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'h') goto yy494;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 't') goto yy494;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != ' ') goto yy494;
yy540:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= ',') {
		if (yych == ' ') goto yy540;
		goto yy494;
	} else {
		if (yych <= '-') {
			yyt2 = cur;
			goto yy541;
		}
		if (yych <= '/') goto yy494;
		if (yych <= '9') {
			yyt2 = cur;
			goto yy542;
		}
		goto yy494;
	}
yy541:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= '/') goto yy494;
	if (yych >= ':') goto yy494;
yy542:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= 'h') {
		if (yych <= '/') {
			if (yych != '.') goto yy494;
		} else {
			if (yych <= '9') goto yy542;
			if (yych == 'c') goto yy544;
			goto yy494;
		}
	} else {
		if (yych <= 'o') {
			if (yych <= 'i') goto yy545;
			if (yych == 'm') goto yy544;
			goto yy494;
		} else {
			if (yych <= 'p') goto yy546;
			if (yych == 't') goto yy547;
			goto yy494;
		}
	}
yy543:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych <= 'i') {
		if (yych <= 'b') {
			if (yych <= '/') goto yy494;
			if (yych <= '9') goto yy543;
			goto yy494;
		} else {
			if (yych <= 'c') goto yy544;
			if (yych <= 'h') goto yy494;
			goto yy545;
		}
	} else {
		if (yych <= 'o') {
			if (yych != 'm') goto yy494;
		} else {
			if (yych <= 'p') goto yy546;
			if (yych == 't') goto yy547;
			goto yy494;
		}
	}
yy544:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'm') goto yy548;
	goto yy494;
yy545:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'n') goto yy548;
	goto yy494;
yy546:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 't') goto yy548;
	goto yy494;
yy547:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych == 'r') goto yy549;
	goto yy494;
yy548:
	++cur;
	f0 = yyt1;
	f1 = yyt2;
#line 1302 "dvi_special.re2c.c"
	{
    *width = pdim(f0, lim);
    *height = pdim(f1, lim);
    return;
  }
#line 5576 "dvi_special.c"
yy549:
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'u') goto yy494;
	++cur;
	yych = cur < lim ? *cur : -1;
	if (yych != 'e') goto yy494;
	++cur;
	yych = cur < lim ? *cur : -1;
	switch (yych) {
		case 'c':
		case 'm': goto yy544;
		case 'i': goto yy545;
		case 'p': goto yy546;
		default: goto yy494;
	}
}
#line 1314 "dvi_special.re2c.c"

}
